<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Equipamentos - Prefeitura Municipal de Campo do Meio</title>
    <style>
        /* Reset e configurações globais - Tema Moderno */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Cores modernas - Tema Profissional */
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            --secondary: #8b5cf6;
            --secondary-light: #a78bfa;
            --accent: #10b981;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --light-gray: #f1f5f9;
            --border: #e2e8f0;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            color: var(--dark);
            background: #f8fafc;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Data e Hora no topo */
        .datetime-header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            color: white;
            padding: 12px 0;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
            z-index: 1001;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .datetime-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .datetime-info {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .datetime-info span {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 6px 12px;
            border-radius: 20px;
        }

        /* Sistema de Login */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.95) 0%, rgba(139, 92, 246, 0.95) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .login-container {
            background: white;
            border-radius: 20px;
            padding: 48px;
            width: 90%;
            max-width: 440px;
            box-shadow: var(--shadow-lg);
            text-align: center;
            animation: slideUp 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .login-container h2 {
            color: var(--dark);
            margin-bottom: 16px;
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .login-container p {
            color: var(--gray);
            margin-bottom: 32px;
            font-size: 1rem;
        }

        .login-form .form-group {
            margin-bottom: 24px;
            text-align: left;
        }

        .login-form label {
            display: block;
            margin-bottom: 10px;
            color: var(--dark);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .login-form input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
            background: white;
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 8px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(37, 99, 235, 0.3);
        }

        /* Cabeçalho */
        header {
            background: linear-gradient(135deg, var(--dark) 0%, #334155 100%);
            color: white;
            padding: 40px 0 30px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(37, 99, 235, 0.15) 0%, transparent 50%);
            pointer-events: none;
        }

        .logo-header {
            display: flex;
            align-items: center;
            gap: 24px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .logo-placeholder {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            border: none;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
        }

        .title-container h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            font-weight: 800;
            color: white;
        }

        .title-container h2 {
            font-size: 1.1rem;
            font-weight: 400;
            opacity: 0.9;
            color: #cbd5e1;
        }

        .header-info {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            font-size: 0.95rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 15px;
            position: relative;
            z-index: 1;
        }

        .header-info p {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Navegação */
        nav {
            background: white;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 48px;
            z-index: 1000;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2px;
        }

        nav ul li {
            flex: 1;
        }

        nav ul li a {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 20px 16px;
            text-decoration: none;
            color: var(--gray);
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border-bottom: 3px solid transparent;
        }

        nav ul li a:hover {
            color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        nav ul li a.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            background: rgba(37, 99, 235, 0.1);
        }

        /* Conteúdo Principal */
        main {
            padding: 40px 0;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 32px;
            margin-bottom: 32px;
            border: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover::before {
            opacity: 1;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        /* Dashboard */
        .dashboard h2 {
            margin-bottom: 32px;
            color: var(--dark);
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 48px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 28px;
            position: relative;
            transition: var(--transition);
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card h3 {
            font-size: 0.95rem;
            color: var(--gray);
            margin-bottom: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card p {
            font-size: 3rem;
            font-weight: 800;
            color: var(--dark);
            line-height: 1;
        }

        .stat-card i {
            position: absolute;
            top: 24px;
            right: 24px;
            font-size: 2.5rem;
            color: rgba(37, 99, 235, 0.1);
        }

        .recent-activity h3 {
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .activity-list {
            background-color: var(--light-gray);
            border-radius: var(--radius);
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border);
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background-color: white;
            border-radius: var(--radius);
            margin-bottom: 10px;
            border-left: 4px solid var(--secondary);
            transition: transform 0.2s ease;
        }

        .activity-item:hover {
            transform: translateX(5px);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        /* Estatísticas */
        .estatisticas-container {
            margin-top: 32px;
        }

        .estatisticas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 28px;
            margin-top: 24px;
        }

        .estatistica-card {
            background: white;
            border-radius: var(--radius);
            padding: 28px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .estatistica-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .estatistica-card h4 {
            color: var(--dark);
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
        }

        .top-list {
            list-style: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .top-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .top-item:last-child {
            border-bottom: none;
        }

        .top-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .top-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .top-details h5 {
            font-weight: 600;
            color: var(--dark);
        }

        .top-details p {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .top-value {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .progress-bar {
            height: 8px;
            background: var(--light-gray);
            border-radius: 4px;
            margin: 5px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .chart-container {
            height: 250px;
            margin-top: 20px;
            position: relative;
        }

        /* Formulários */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        .form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        /* Botões */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px -10px rgba(37, 99, 235, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            background: var(--light);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px -10px rgba(239, 68, 68, 0.4);
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #2ecc71);
            color: white;
        }

        /* Controle de Estoque */
        .estoque-container {
            margin-top: 32px;
        }

        .estoque-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 28px;
            margin-top: 24px;
        }

        .estoque-card {
            background: white;
            border-radius: var(--radius);
            padding: 28px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .estoque-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .estoque-card-header {
            display: flex;
            align-items: flex-start;
            gap: 18px;
            margin-bottom: 24px;
            padding-bottom: 18px;
            border-bottom: 2px solid var(--light-gray);
        }

        .estoque-icon {
            width: 70px;
            height: 70px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            flex-shrink: 0;
        }

        .estoque-info {
            flex: 1;
        }

        .estoque-info h4 {
            color: var(--dark);
            margin-bottom: 6px;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .estoque-info input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            margin-bottom: 8px;
        }

        .estoque-info input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .estoque-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .estoque-quantidade {
            text-align: center;
            margin: 28px 0;
        }

        .quantidade-display {
            font-size: 4rem;
            font-weight: 800;
            color: var(--primary);
            line-height: 1;
            margin-bottom: 8px;
        }

        .quantidade-label {
            color: var(--gray);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-weight: 600;
        }

        .estoque-controles {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .quantidade-input {
            flex: 1;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1.1rem;
            text-align: center;
            transition: var(--transition);
            font-weight: 600;
        }

        .quantidade-input:focus {
            border-color: var(--primary);
        }

        .estoque-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            display: block;
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--dark);
        }

        .stat-label {
            display: block;
            font-size: 0.75rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 4px;
            font-weight: 600;
        }

        .estoque-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .badge-disponivel {
            background: linear-gradient(135deg, var(--accent), #059669);
            color: white;
        }

        .badge-baixo {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: white;
        }

        .badge-critico {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        .badge-sem {
            background: linear-gradient(135deg, var(--gray), #475569);
            color: white;
        }

        /* Botão para adicionar novo produto */
        .add-product-btn {
            background: linear-gradient(135deg, var(--accent), var(--primary));
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 10px 25px -5px rgba(16, 185, 129, 0.4);
        }

        .add-product-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 35px -5px rgba(16, 185, 129, 0.5);
        }

        /* Modal para produto */
        .product-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .product-modal.active {
            display: flex;
        }

        .product-modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
        }

        /* Termo de Aquisição */
        .termo-acquisition-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .termo-preview {
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 40px;
            margin-top: 30px;
            box-shadow: var(--shadow);
            min-height: 500px;
            position: relative;
        }

        .termo-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 3px solid var(--primary);
        }

        .termo-header h2 {
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .termo-header h3 {
            color: var(--dark);
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .termo-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .termo-table th {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 18px;
            text-align: left;
            font-weight: 600;
        }

        .termo-table td {
            padding: 18px;
            border-bottom: 1px solid var(--border);
            background: white;
        }

        .termo-table tr:hover td {
            background: var(--light-gray);
        }

        /* Assinaturas Digitalizadas */
        .assinatura-container {
            margin: 25px 0;
            padding: 25px;
            background: var(--light-gray);
            border-radius: var(--radius);
            border: 2px solid var(--border);
        }

        .assinatura-opcoes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .assinatura-upload {
            text-align: center;
            padding: 20px;
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            background: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .assinatura-upload:hover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .assinatura-canvas-container {
            text-align: center;
        }

        .assinatura-canvas {
            border: 2px solid var(--border);
            background: white;
            border-radius: 10px;
            margin: 15px auto;
            cursor: crosshair;
            touch-action: none;
        }

        .assinatura-controles {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .assinatura-preview {
            max-width: 200px;
            max-height: 100px;
            margin: 0 auto;
            display: none;
            border: 1px solid var(--border);
            border-radius: 5px;
        }

        .assinatura-preview.visible {
            display: block;
        }

        /* Equipamentos Table */
        .equipamentos-table-container {
            overflow-x: auto;
            margin: 30px 0;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .equipamentos-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        .equipamentos-table th {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .equipamentos-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .equipamentos-table tr:hover td {
            background-color: rgba(37, 99, 235, 0.05);
        }

        .acoes-cell {
            display: flex;
            gap: 10px;
        }

        .quantidade-cell {
            text-align: center;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .status-cell {
            text-align: center;
        }

        /* Tabelas */
        .table-container {
            overflow-x: auto;
            margin-bottom: 25px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        tbody tr:hover {
            background-color: rgba(37, 99, 235, 0.05);
        }

        /* Rodapé */
        footer {
            background: linear-gradient(135deg, var(--dark) 0%, #334155 100%);
            color: white;
            padding: 40px 0 20px;
        }

        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-small-placeholder {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .footer-info p {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 20px;
            text-align: center;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            .datetime-info {
                flex-direction: column;
                gap: 10px;
            }
            
            nav ul {
                flex-direction: column;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .estatisticas-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .estoque-grid {
                grid-template-columns: 1fr;
            }
            
            .estoque-controles {
                flex-direction: column;
            }
            
            .termo-assinaturas {
                grid-template-columns: 1fr;
            }
            
            .login-container {
                padding: 32px 24px;
            }
            
            .footer-content {
                flex-direction: column;
            }
            
            .assinatura-opcoes {
                grid-template-columns: 1fr;
            }
            
            .acoes-cell {
                flex-direction: column;
                gap: 5px;
            }
        }

        /* Animações */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Modal para visualizar termos salvos */
        .termos-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .termos-modal.active {
            display: flex;
        }
        
        .termos-modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .termos-list {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }
        
        .termo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }
        
        .termo-item:hover {
            background: var(--light-gray);
        }
        
        .termo-item:last-child {
            border-bottom: none;
        }
        
        .termo-item-info h4 {
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .termo-item-info p {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .termo-item-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Tabela de termos salvos */
        .termos-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .termos-table th {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .termos-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .termos-table tr:hover td {
            background: var(--light-gray);
        }

        /* Status de sincronização */
        .sync-status {
            position: fixed;
            bottom: 100px;
            right: 30px;
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 10px 15px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            font-size: 0.8rem;
            color: var(--gray);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sync-status.visible {
            opacity: 1;
        }

        .sync-status.syncing {
            color: var(--warning);
        }

        .sync-status.synced {
            color: var(--success);
        }

        .sync-status.error {
            color: var(--danger);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Data e Hora no topo -->
    <div class="datetime-header">
        <div class="container datetime-container">
            <div class="datetime-info">
                <span id="current-date">
                    <i class="fas fa-calendar-alt"></i>
                    <span id="date-display">Carregando...</span>
                </span>
                <span id="current-time">
                    <i class="fas fa-clock"></i>
                    <span id="time-display">Carregando...</span>
                </span>
            </div>
            <div class="user-status" id="userStatus" style="display: none;">
                <i class="fas fa-user-check"></i>
                <span id="loggedUser">Administrador</span>
                <button class="logout-btn" id="logoutBtn" style="background: none; border: none; color: white; cursor: pointer; margin-left: 10px;">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
        </div>
    </div>

    <!-- Status de sincronização -->
    <div class="sync-status" id="syncStatus">
        <i class="fas fa-sync"></i>
        <span id="syncText">Sincronizado</span>
    </div>

    <!-- Sistema de Login -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-container">
            <h2><i class="fas fa-lock"></i> Acesso Restrito</h2>
            <p>Digite suas credenciais para acessar o sistema</p>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="username">Usuário</label>
                    <input type="text" id="username" placeholder="Digite seu usuário" required>
                </div>
                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" placeholder="Digite sua senha" required>
                </div>
                <button type="submit" class="login-btn">Entrar no Sistema</button>
            </form>
            <div class="login-info">
                <p><strong>Credenciais padrão:</strong></p>
                <p>Usuário: <strong>admin</strong></p>
                <p>Senha: <strong>campo2025</strong></p>
                <p style="margin-top: 10px; font-size: 0.8rem; color: var(--warning);">
                    <i class="fas fa-exclamation-circle"></i> Apenas usuários autorizados
                </p>
            </div>
        </div>
    </div>

    <!-- Botão para adicionar novo produto -->
    <button class="add-product-btn" id="addProductBtn" title="Adicionar Novo Produto" style="display: none;">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Modal para adicionar/editar produto -->
    <div class="product-modal" id="productModal">
        <div class="product-modal-content">
            <div class="product-modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 id="modalTitle">Adicionar Novo Produto</h3>
                <button class="close-modal" style="background: none; border: none; font-size: 1.8rem; color: var(--gray); cursor: pointer;">&times;</button>
            </div>
            <form id="productForm">
                <input type="hidden" id="productKey" value="">
                <div class="form-group">
                    <label for="productName">Nome do Produto *</label>
                    <input type="text" id="productName" placeholder="Ex: Teclado Gamer RGB" required>
                </div>
                <div class="form-group">
                    <label for="productCategory">Categoria *</label>
                    <select id="productCategory" required>
                        <option value="">Selecione uma categoria</option>
                        <option value="teclado">Teclado</option>
                        <option value="mouse">Mouse</option>
                        <option value="monitor">Monitor</option>
                        <option value="notebook">Notebook</option>
                        <option value="impressora">Impressora</option>
                        <option value="toner">Toner</option>
                        <option value="tinta">Tinta Impressora</option>
                        <option value="cabo">Cabo</option>
                        <option value="filtro">Filtro de Linha</option>
                        <option value="adaptador">Adaptador</option>
                        <option value="roteador">Roteador</option>
                        <option value="switch">Switch</option>
                        <option value="pendrive">Pendrive</option>
                        <option value="acessorios">Acessórios</option>
                        <option value="perifericos">Periféricos</option>
                        <option value="outros">Outros</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="productQuantity">Quantidade *</label>
                        <input type="number" id="productQuantity" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label for="productMin">Estoque Mínimo *</label>
                        <input type="number" id="productMin" min="1" value="5" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="productIcon">Ícone (Classe FontAwesome)</label>
                    <input type="text" id="productIcon" placeholder="Ex: fa-keyboard" value="fa-box">
                    <small style="color: var(--gray); font-size: 0.8rem;">Veja ícones em: <a href="https://fontawesome.com/icons" target="_blank">fontawesome.com</a></small>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="btn btn-primary" id="saveProductBtn">
                        <i class="fas fa-save"></i> Salvar Produto
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancelProductBtn">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="button" class="btn btn-danger" id="deleteProductBtn" style="display: none;">
                        <i class="fas fa-trash"></i> Excluir
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para visualizar termos salvos -->
    <div class="termos-modal" id="termosModal">
        <div class="termos-modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3><i class="fas fa-file-contract"></i> Termos de Aquisição Salvos</h3>
                <button class="close-termos-modal" style="background: none; border: none; font-size: 1.8rem; color: var(--gray); cursor: pointer;">&times;</button>
            </div>
            
            <div class="form-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" id="novoTermoBtn">
                    <i class="fas fa-plus"></i> Novo Termo
                </button>
                <button class="btn btn-secondary" id="fecharTermosBtn">
                    <i class="fas fa-times"></i> Fechar
                </button>
            </div>
            
            <div class="table-container">
                <table class="termos-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Nº Patrimônio</th>
                            <th>Equipamento</th>
                            <th>Responsável</th>
                            <th>Departamento</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="termos-table-body">
                        <!-- Dados serão preenchidos via JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div style="text-align: center; margin-top: 20px; color: var(--gray);">
                <p><i class="fas fa-info-circle"></i> Total de termos salvos: <span id="total-termos">0</span></p>
            </div>
        </div>
    </div>

    <!-- Cabeçalho -->
    <header>
        <div class="container">
            <div class="logo-header">
                <div class="logo-placeholder">
                    <i class="fas fa-laptop-code"></i>
                </div>
                <div class="title-container">
                    <h1>Secretaria de Educação - Campo do Meio</h1>
                    <h2>Controle de Equipamentos de Informática</h2>
                </div>
            </div>
            <div class="header-info">
                <p><i class="fas fa-map-marker-alt"></i> Rua José Mesquita Neto 356 (Centro), Campo do Meio, MG</p>
                <p><i class="fas fa-phone"></i> (35) 3857-1122</p>
                <p><i class="fas fa-lock"></i> Sistema de acesso restrito</p>
            </div>
        </div>
    </header>

    <!-- Navegação -->
    <nav>
        <div class="container">
            <ul>
                <li><a href="#home" class="nav-link active" data-section="home"><i class="fas fa-home"></i> Início</a></li>
                <li><a href="#registrar" class="nav-link" data-section="registrar"><i class="fas fa-plus-circle"></i> Novo Registro</a></li>
                <li><a href="#consultar" class="nav-link" data-section="consultar"><i class="fas fa-search"></i> Consultar</a></li>
                <li><a href="#estatisticas" class="nav-link" data-section="estatisticas"><i class="fas fa-chart-bar"></i> Estatísticas</a></li>
                <li><a href="#termo-aquisicao" class="nav-link" data-section="termo-aquisicao"><i class="fas fa-file-contract"></i> Termo de Aquisição</a></li>
                <li><a href="#estoque" class="nav-link" data-section="estoque"><i class="fas fa-boxes"></i> Controle de Estoque</a></li>
                <li><a href="#configuracoes" class="nav-link" data-section="configuracoes"><i class="fas fa-cog"></i> Configurações</a></li>
            </ul>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main class="container">
        <!-- Seção de Dashboard -->
        <section id="home" class="section active">
            <div class="dashboard">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                <div class="stats">
                    <div class="stat-card">
                        <h3>Total de Itens</h3>
                        <p id="total-itens">87</p>
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="stat-card">
                        <h3>Registros Totais</h3>
                        <p id="total-registros">87</p>
                        <i class="fas fa-list"></i>
                    </div>
                    <div class="stat-card">
                        <h3>Equipamentos</h3>
                        <p id="tipos-equipamentos">14</p>
                        <i class="fas fa-laptop"></i>
                    </div>
                    <div class="stat-card">
                        <h3>Locais</h3>
                        <p id="total-locais">28</p>
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                </div>
                
                <div class="recent-activity">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3><i class="fas fa-history"></i> Atividade Recente</h3>
                        <span style="color: var(--gray); font-size: 0.9rem;">
                            <i class="fas fa-info-circle"></i> Mostrando <span id="activity-count">0</span> registros
                        </span>
                    </div>
                    <div class="activity-list" id="recent-activity-list">
                        <!-- Atividades serão carregadas via JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção de Registro (ATUALIZADA) -->
        <section id="registrar" class="section">
            <h2><i class="fas fa-plus-circle"></i> Registrar Novo Empréstimo</h2>
            <div class="card">
                <form id="registro-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="equipamento">Equipamento *</label>
                            <input type="text" id="equipamento" placeholder="Digite o nome do equipamento" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="quantidade">Quantidade *</label>
                            <input type="number" id="quantidade" min="1" max="100" value="1" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="local">Local de Destino *</label>
                            <input type="text" id="local" placeholder="Digite o local de destino" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="data">Data *</label>
                            <input type="date" id="data" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="responsavel">Responsável pelo Recebimento *</label>
                        <input type="text" id="responsavel" placeholder="Nome completo do responsável" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="telefone-responsavel">Telefone Pessoal *</label>
                            <input type="tel" id="telefone-responsavel" placeholder="(35) 99999-9999" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="email-responsavel">Email</label>
                            <input type="email" id="email-responsavel" placeholder="email@exemplo.com">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="observacoes">Observações</label>
                        <textarea id="observacoes" rows="3" placeholder="Observações adicionais"></textarea>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary" id="salvarRegistro">
                            <i class="fas fa-save"></i> Salvar Registro
                        </button>
                        <button type="reset" class="btn btn-secondary" id="limpar-form">
                            <i class="fas fa-eraser"></i> Limpar
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Seção de Consulta (ATUALIZADA com botão de excluir) -->
        <section id="consultar" class="section">
            <h2><i class="fas fa-search"></i> Consultar Empréstimos</h2>
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div style="color: var(--gray);">
                        <i class="fas fa-list"></i> Total de registros: <span id="total-registros-consulta">87</span>
                    </div>
                    <div class="search-bar" style="display: flex; gap: 15px;">
                        <input type="text" id="search-input" placeholder="Buscar por equipamento, local ou responsável..." style="flex: 1; padding: 14px; border: 2px solid var(--border); border-radius: 10px;">
                        <button id="search-btn" class="btn btn-primary">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                        <button id="clear-search" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Limpar
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="registros-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Equipamento</th>
                                <th>Quantidade</th>
                                <th>Local</th>
                                <th>Data</th>
                                <th>Responsável</th>
                                <th>Telefone</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="table-body">
                            <!-- Dados serão preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Seção de Estatísticas -->
        <section id="estatisticas" class="section">
            <h2><i class="fas fa-chart-bar"></i> Estatísticas</h2>
            <div class="card">
                <div class="estatisticas-container">
                    <h3><i class="fas fa-chart-pie"></i> Análise de Dados</h3>
                    
                    <div class="estatisticas-grid">
                        <!-- Top Locais -->
                        <div class="estatistica-card">
                            <h4><i class="fas fa-map-marker-alt"></i> Top 10 Locais com Mais Equipamentos</h4>
                            <div class="top-list" id="top-locais">
                                <!-- Dados serão carregados via JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Top Equipamentos -->
                        <div class="estatistica-card">
                            <h4><i class="fas fa-box"></i> Top 10 Equipamentos Mais Utilizados</h4>
                            <div class="top-list" id="top-equipamentos">
                                <!-- Dados serão carregados via JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Estatísticas por Mês -->
                        <div class="estatistica-card">
                            <h4><i class="fas fa-calendar-alt"></i> Distribuição por Mês</h4>
                            <div class="top-list" id="estatisticas-mes">
                                <!-- Dados serão carregados via JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Estatísticas Gerais -->
                        <div class="estatistica-card">
                            <h4><i class="fas fa-chart-line"></i> Estatísticas Gerais</h4>
                            <div style="padding: 15px 0;">
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span>Média por registro</span>
                                        <span id="media-quantidade">0</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="progress-media" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span>Dias com registros</span>
                                        <span id="dias-registros">0</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="progress-dias" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span>Locais distintos</span>
                                        <span id="locais-distintos">0</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="progress-locais" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span>Equipamentos distintos</span>
                                        <span id="equipamentos-distintos">0</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="progress-equipamentos" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção de Termo de Aquisição (ATUALIZADA COM SALVAR NO SITE) -->
        <section id="termo-aquisicao" class="section">
            <h2><i class="fas fa-file-contract"></i> Termo de Aquisição</h2>
            <div class="card termo-acquisition-container">
                <!-- Botões para gerenciar termos -->
                <div class="form-buttons" style="margin-bottom: 20px;">
                    <button class="btn btn-primary" id="visualizarTermosBtn">
                        <i class="fas fa-list"></i> Ver Termos Salvos
                    </button>
                    <span style="color: var(--gray); margin-left: auto;">
                        <i class="fas fa-info-circle"></i> <span id="total-termos-section">0</span> termos salvos
                    </span>
                </div>
                
                <form id="termo-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="termo-tipo-equipamento">Tipo de Equipamento *</label>
                            <select id="termo-tipo-equipamento" required>
                                <option value="">Selecione o tipo</option>
                                <option value="notebook">Notebook</option>
                                <option value="pc">Computador (PC)</option>
                                <option value="impressora">Impressora</option>
                                <option value="monitor">Monitor</option>
                                <option value="tablet">Tablet</option>
                                <option value="projetor">Projetor</option>
                                <option value="scanner">Scanner</option>
                                <option value="outro">Outro (escrever manualmente)</option>
                            </select>
                            <input type="text" id="termo-tipo-manual" placeholder="Digite o tipo de equipamento" style="display: none; margin-top: 10px;">
                        </div>
                        
                        <div class="form-group">
                            <label for="termo-marca">Marca *</label>
                            <input type="text" id="termo-marca" placeholder="Ex: Dell, HP, Samsung" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="termo-modelo">Modelo *</label>
                            <input type="text" id="termo-modelo" placeholder="Ex: Inspiron 15, LaserJet Pro" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="termo-serial">Número de Série</label>
                            <input type="text" id="termo-serial" placeholder="Número de série do equipamento">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="termo-patrimonio">Número do Patrimônio *</label>
                            <input type="text" id="termo-patrimonio" placeholder="Ex: PMCM-2023-00123" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="termo-fornecedor">Fornecedor *</label>
                            <input type="text" id="termo-fornecedor" placeholder="Nome do fornecedor" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="termo-nota-fiscal">Nota Fiscal *</label>
                            <input type="text" id="termo-nota-fiscal" placeholder="Número da nota fiscal" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="termo-data-aquisicao">Data de Aquisição *</label>
                            <input type="date" id="termo-data-aquisicao" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="termo-valor">Valor (R$) *</label>
                            <input type="number" id="termo-valor" step="0.01" min="0" placeholder="0,00" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="termo-departamento">Departamento Destino *</label>
                            <select id="termo-departamento" required>
                                <option value="">Selecione o departamento</option>
                                <option value="secretaria_educacao">Secretaria de Educação</option>
                                <option value="secretaria_saude">Secretaria de Saúde</option>
                                <option value="secretaria_administracao">Secretaria de Administração</option>
                                <option value="secretaria_agricultura">Secretaria de Agricultura</option>
                                <option value="gabinete_prefeitura">Gabinete da Prefeitura</option>
                                <option value="cras">CRAS</option>
                                <option value="biblioteca">Biblioteca Municipal</option>
                                <option value="outro">Outro (escrever manualmente)</option>
                            </select>
                            <input type="text" id="termo-departamento-manual" placeholder="Digite o departamento" style="display: none; margin-top: 10px;">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="termo-responsavel">Responsável pelo Recebimento *</label>
                            <input type="text" id="termo-responsavel" placeholder="Nome completo" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="termo-telefone-pessoal">Telefone Pessoal *</label>
                            <input type="tel" id="termo-telefone-pessoal" placeholder="(35) 99999-9999" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="termo-email">Email</label>
                            <input type="email" id="termo-email" placeholder="email@exemplo.com">
                        </div>
                        
                        <div class="form-group">
                            <label for="termo-cargo">Cargo</label>
                            <input type="text" id="termo-cargo" placeholder="Cargo do responsável">
                        </div>
                    </div>
                    
                    <!-- Seção de Assinatura Digitalizada -->
                    <div class="assinatura-container">
                        <h3><i class="fas fa-signature"></i> Assinatura Digitalizada</h3>
                        <p style="margin-bottom: 15px; color: var(--gray);">Escolha uma forma de adicionar a assinatura:</p>
                        
                        <div class="assinatura-opcoes">
                            <div class="assinatura-upload" id="uploadAssinatura">
                                <i class="fas fa-upload" style="font-size: 2rem; color: var(--primary); margin-bottom: 10px;"></i>
                                <h4>Carregar Foto</h4>
                                <p style="font-size: 0.9rem; color: var(--gray);">Clique para selecionar uma imagem</p>
                                <input type="file" id="assinaturaFile" accept="image/*" style="display: none;">
                            </div>
                            
                            <div class="assinatura-canvas-container">
                                <h4>Desenhar Assinatura</h4>
                                <canvas id="assinaturaCanvas" width="400" height="150" class="assinatura-canvas"></canvas>
                                <div class="assinatura-controles">
                                    <button type="button" id="limparAssinatura" class="btn btn-secondary btn-small">
                                        <i class="fas fa-eraser"></i> Limpar
                                    </button>
                                    <button type="button" id="salvarAssinatura" class="btn btn-primary btn-small">
                                        <i class="fas fa-save"></i> Salvar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <h4>Prévia da Assinatura</h4>
                            <img id="assinaturaPreview" class="assinatura-preview" alt="Prévia da assinatura">
                            <p id="semAssinatura" style="color: var(--gray); font-style: italic;">Nenhuma assinatura adicionada</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="termo-observacoes">Observações / Especificações Técnicas</label>
                        <textarea id="termo-observacoes" rows="4" placeholder="Descreva características técnicas, configurações, acessórios incluídos, etc."></textarea>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" class="btn btn-primary" id="gerarTermoBtn">
                            <i class="fas fa-file-contract"></i> Gerar Termo
                        </button>
                        <button type="button" class="btn btn-secondary" id="limpar-termo">
                            <i class="fas fa-eraser"></i> Limpar
                        </button>
                    </div>
                </form>
                
                <!-- Preview do Termo -->
                <div class="termo-preview" id="termo-preview" style="display: none; margin-top: 40px;">
                    <div class="termo-header">
                        <h2>TERMO DE AQUISIÇÃO E RECEBIMENTO</h2>
                        <h3>PREFEITURA MUNICIPAL DE CAMPO DO MEIO - MG</h3>
                        <p>Secretaria Municipal de Educação</p>
                        <div style="margin-top: 15px; font-size: 0.9rem; color: var(--gray);">
                            <i class="fas fa-calendar-alt"></i> Data: <span id="preview-data"></span>
                            <span style="margin-left: 20px;"><i class="fas fa-hashtag"></i> Nº: <span id="preview-numero-termo">001</span></span>
                        </div>
                    </div>
                    
                    <div style="margin: 30px 0;">
                        <p>Eu, <strong id="preview-responsavel"></strong>, no cargo de <strong id="preview-cargo"></strong>, responsável pelo departamento de <strong id="preview-departamento"></strong>, declaro ter recebido o seguinte equipamento de informática, adquirido pela Prefeitura Municipal de Campo do Meio:</p>
                        
                        <table class="termo-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Descrição</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Tipo</strong></td>
                                    <td id="preview-tipo"></td>
                                </tr>
                                <tr>
                                    <td><strong>Marca/Modelo</strong></td>
                                    <td id="preview-marca-modelo"></td>
                                </tr>
                                <tr>
                                    <td><strong>Nº de Série</strong></td>
                                    <td id="preview-serial"></td>
                                </tr>
                                <tr>
                                    <td><strong>Nº do Patrimônio</strong></td>
                                    <td id="preview-patrimonio"></td>
                                </tr>
                                <tr>
                                    <td><strong>Fornecedor</strong></td>
                                    <td id="preview-fornecedor"></td>
                                </tr>
                                <tr>
                                    <td><strong>Nota Fiscal</strong></td>
                                    <td id="preview-nota-fiscal"></td>
                                </tr>
                                <tr>
                                    <td><strong>Data de Aquisição</strong></td>
                                    <td id="preview-data-aquisicao"></td>
                                </tr>
                                <tr>
                                    <td><strong>Valor</strong></td>
                                    <td id="preview-valor"></td>
                                </tr>
                                <tr>
                                    <td><strong>Telefone Pessoal</strong></td>
                                    <td id="preview-telefone"></td>
                                </tr>
                                <tr>
                                    <td><strong>Email</strong></td>
                                    <td id="preview-email"></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div style="margin: 30px 0;">
                            <h4>OBSERVAÇÕES / ESPECIFICAÇÕES TÉCNICAS</h4>
                            <p id="preview-observacoes" style="white-space: pre-line; background: var(--light-gray); padding: 15px; border-radius: 8px;"></p>
                        </div>
                        
                        <p>Declaro que o equipamento acima descrito foi recebido em perfeitas condições de funcionamento e assumo a responsabilidade pela sua guarda, conservação e uso adequado, comprometendo-me a comunicar imediatamente qualquer avaria ou problema técnico.</p>
                        
                        <p style="margin-top: 30px;">Campo do Meio, <span id="preview-data-hoje"></span>.</p>
                    </div>
                    
                    <div class="termo-assinaturas" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px;">
                        <div class="assinatura-box">
                            <p><strong>ASSINATURA DO RESPONSÁVEL</strong></p>
                            <div id="assinaturaResponsavelPreview" style="height: 150px; display: flex; align-items: center; justify-content: center; border: 2px solid var(--border); border-radius: 10px; margin: 15px auto; background: white; position: relative;">
                                <img id="assinaturaResponsavelImg" style="max-width: 90%; max-height: 90%;" alt="Assinatura do responsável">
                                <p id="assinaturaPlaceholder" style="color: var(--gray); position: absolute;">Assinatura digitalizada</p>
                            </div>
                            <div style="border-top: 1px solid var(--dark); margin: 20px auto; width: 200px;"></div>
                            <p id="preview-nome-assinatura" style="font-weight: bold;"></p>
                            <p>Responsável pelo Departamento</p>
                            <p id="preview-telefone-assinatura"></p>
                        </div>
                        
                        <div class="assinatura-box">
                            <p><strong>ASSINATURA DO TÉCNICO</strong></p>
                            <div style="height: 150px; display: flex; align-items: center; justify-content: center; color: var(--gray); border: 2px solid var(--border); border-radius: 10px; margin: 15px auto; background: white;">
                                <p>Assinatura do Técnico de Informática</p>
                            </div>
                            <div style="border-top: 1px solid var(--dark); margin: 20px auto; width: 200px;"></div>
                            <p style="font-weight: bold;">________________________________</p>
                            <p>Técnico de Informática</p>
                            <p>Secretaria de Educação</p>
                        </div>
                    </div>
                    
                    <div class="form-buttons" style="margin-top: 40px;">
                        <button id="imprimir-termo" class="btn btn-primary">
                            <i class="fas fa-print"></i> Imprimir Termo
                        </button>
                        <button id="salvar-termo-site" class="btn btn-success">
                            <i class="fas fa-save"></i> Salvar no Site
                        </button>
                        <button id="fechar-preview" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Fechar
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção de Controle de Estoque -->
        <section id="estoque" class="section">
            <h2><i class="fas fa-boxes"></i> Controle de Estoque</h2>
            <div class="card">
                <div class="estoque-container">
                    <h3><i class="fas fa-warehouse"></i> Estoque de Equipamentos</h3>
                    
                    <div class="equipamentos-table-container">
                        <table class="equipamentos-table">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>Categoria</th>
                                    <th>Quantidade</th>
                                    <th>Estoque Mínimo</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="estoque-table-body">
                                <!-- Dados serão preenchidos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="form-buttons" style="margin-top: 20px;">
                        <button class="btn btn-primary" id="adicionarProdutoBtn">
                            <i class="fas fa-plus"></i> Adicionar Novo Produto
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seção de Configurações -->
        <section id="configuracoes" class="section">
            <h2><i class="fas fa-cog"></i> Configurações</h2>
            <div class="card">
                <div class="settings-tabs">
                    <div class="tab-buttons" style="display: flex; border-bottom: 1px solid var(--border); margin-bottom: 25px;">
                        <button class="tab-btn active" data-tab="equipamentos">Equipamentos</button>
                        <button class="tab-btn" data-tab="locais">Locais</button>
                        <button class="tab-btn" data-tab="termos">Termos Salvos</button>
                        <button class="tab-btn" data-tab="backup">Backup</button>
                        <button class="tab-btn" data-tab="sincronizacao">Sincronização</button>
                    </div>
                    
                    <div class="tab-content">
                        <div id="equipamentos" class="tab-pane active">
                            <h3>Gerenciar Tipos de Equipamentos</h3>
                            <div class="manage-list">
                                <ul id="equipamentos-list" style="list-style: none;">
                                </ul>
                            </div>
                        </div>
                        
                        <div id="locais" class="tab-pane">
                            <h3>Gerenciar Locais</h3>
                            <div class="manage-list">
                                <ul id="locais-list" style="list-style: none;">
                                </ul>
                            </div>
                        </div>
                        
                        <div id="termos" class="tab-pane">
                            <h3><i class="fas fa-file-contract"></i> Gerenciar Termos Salvos</h3>
                            <div style="margin-bottom: 20px;">
                                <p>Total de termos salvos: <strong id="config-termos-count">0</strong></p>
                                <p>Último termo: <span id="ultimo-termo">Nenhum termo salvo</span></p>
                            </div>
                            
                            <div class="form-buttons">
                                <button class="btn btn-primary" id="verTermosConfigBtn">
                                    <i class="fas fa-list"></i> Ver Todos os Termos
                                </button>
                                <button class="btn btn-danger" id="limparTermosBtn">
                                    <i class="fas fa-trash"></i> Limpar Todos
                                </button>
                            </div>
                        </div>
                        
                        <div id="backup" class="tab-pane">
                            <h3><i class="fas fa-database"></i> Backup de Dados</h3>
                            <div style="margin-bottom: 20px;">
                                <p><i class="fas fa-info-circle"></i> Faça backup dos dados do sistema para garantir que suas informações estão seguras.</p>
                                <p><strong>Dados incluídos:</strong> Registros, Estoque, Termos de Aquisição</p>
                            </div>
                            
                            <div class="form-buttons">
                                <button class="btn btn-primary" id="exportarBackupBtn">
                                    <i class="fas fa-download"></i> Exportar Backup
                                </button>
                                <button class="btn btn-secondary" id="importarBackupBtn">
                                    <i class="fas fa-upload"></i> Importar Backup
                                </button>
                                <button class="btn btn-success" id="forcarSincronizacaoBtn">
                                    <i class="fas fa-sync-alt"></i> Forçar Sincronização
                                </button>
                            </div>
                        </div>
                        
                        <div id="sincronizacao" class="tab-pane">
                            <h3><i class="fas fa-sync-alt"></i> Sincronização entre Dispositivos</h3>
                            <div style="margin-bottom: 20px;">
                                <p><i class="fas fa-info-circle"></i> Sistema corrigido para manter estoque sincronizado entre PC e Celular.</p>
                                
                                <div class="sync-info" style="background: var(--light-gray); padding: 15px; border-radius: var(--radius); margin-bottom: 15px;">
                                    <h4><i class="fas fa-microchip"></i> Informações do Sistema</h4>
                                    <p>ID do Dispositivo: <strong id="device-id-info">Carregando...</strong></p>
                                    <p>Última Sincronização: <strong id="last-sync-info">Carregando...</strong></p>
                                    <p>Dispositivos Ativos: <strong id="active-devices-info">0</strong></p>
                                </div>
                                
                                <div class="sync-actions">
                                    <h4><i class="fas fa-cogs"></i> Ações de Sincronização</h4>
                                    <p>Use estas opções para resolver problemas de sincronização:</p>
                                    
                                    <div class="form-buttons" style="margin-top: 15px;">
                                        <button class="btn btn-primary" id="limparDadosLocalBtn">
                                            <i class="fas fa-eraser"></i> Limpar Dados Local
                                        </button>
                                        <button class="btn btn-secondary" id="recarregarDadosBtn">
                                            <i class="fas fa-redo"></i> Recarregar do Servidor
                                        </button>
                                        <button class="btn btn-danger" id="resetarDispositivoBtn">
                                            <i class="fas fa-trash-restore"></i> Resetar Dispositivo
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Rodapé -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="logo-small-placeholder">
                        <i class="fas fa-laptop-code"></i>
                    </div>
                    <div>
                        <h3>Prefeitura Municipal de Campo do Meio</h3>
                        <p>Secretaria de Educação - Controle de Equipamentos</p>
                    </div>
                </div>
                <div class="footer-info">
                    <p><i class="fas fa-map-marker-alt"></i> Rua José Mesquita Neto 356, Campo do Meio, MG</p>
                    <p><i class="fas fa-phone"></i> (35) 3857-1122</p>
                    <p><i class="fas fa-clock"></i> <span id="footer-time"></span></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Prefeitura Municipal de Campo do Meio. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <script>
        // ==============================================
        // SISTEMA PRINCIPAL - COM SINCRONIZAÇÃO ENTRE DISPOSITIVOS
        // ==============================================

        // Configuração do sistema
        const CONFIG = {
            APP_NAME: 'ControleEquipamentos_PMCM',
            APP_VERSION: '2.0',
            SYNC_INTERVAL: 30000, // 30 segundos
            MAX_SYNC_ATTEMPTS: 3
        };

        // Dados iniciais - AGORA CENTRALIZADOS
        let dadosSistema = {
            registros: [],
            estoque: {},
            tiposLocais: [],
            termosAquisicao: [],
            dispositivosConectados: [],
            ultimaSincronizacao: null,
            dispositivoAtual: null
        };

        // Usuários autorizados
        const usuariosAutorizados = [
            { username: "admin", password: "campo2025", nome: "Administrador", nivel: "admin" },
            { username: "tecnico", password: "tecnico123", nome: "Técnico Informática", nivel: "tecnico" }
        ];

        let usuarioLogado = null;
        let isLoggedIn = false;

        // Variáveis para assinatura
        let assinaturaDataURL = null;
        let canvas = null;
        let ctx = null;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let termoAtual = null;

        // ==============================================
        // FUNÇÕES DE SINCRONIZAÇÃO ENTRE DISPOSITIVOS
        // ==============================================

        // Identificar dispositivo atual
        function identificarDispositivo() {
            let dispositivoId = localStorage.getItem('dispositivo_id');
            
            if (!dispositivoId) {
                // Criar ID único para este dispositivo
                dispositivoId = 'disp_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('dispositivo_id', dispositivoId);
                localStorage.setItem('dispositivo_nome', navigator.userAgent);
            }
            
            dadosSistema.dispositivoAtual = {
                id: dispositivoId,
                nome: localStorage.getItem('dispositivo_nome') || navigator.userAgent,
                ultimoAcesso: new Date().toISOString()
            };
            
            console.log('Dispositivo identificado:', dispositivoId);
            atualizarInfoSincronizacao();
        }

        // Função para carregar dados - VERIFICA QUAL DISPOSITIVO TEM OS DADOS MAIS ATUAIS
        function carregarDadosSincronizados() {
            console.log('Carregando dados sincronizados...');
            
            // Tentar carregar do localStorage local primeiro
            const dadosLocais = localStorage.getItem(CONFIG.APP_NAME + '_dados');
            const dadosRemotos = localStorage.getItem(CONFIG.APP_NAME + '_dados_sincronizados');
            
            let dadosLocaisObj = dadosLocais ? JSON.parse(dadosLocais) : null;
            let dadosRemotosObj = dadosRemotos ? JSON.parse(dadosRemotos) : null;
            
            // Decidir quais dados usar (prioridade: dados com timestamp mais recente)
            if (dadosLocaisObj && dadosRemotosObj) {
                const dataLocal = new Date(dadosLocaisObj.ultimaSincronizacao || 0);
                const dataRemoto = new Date(dadosRemotosObj.ultimaSincronizacao || 0);
                
                if (dataRemoto > dataLocal) {
                    console.log('Usando dados remotos (mais recentes)');
                    dadosSistema = dadosRemotosObj;
                } else {
                    console.log('Usando dados locais (mais recentes)');
                    dadosSistema = dadosLocaisObj;
                }
            } else if (dadosLocaisObj) {
                console.log('Usando dados locais (únicos disponíveis)');
                dadosSistema = dadosLocaisObj;
            } else if (dadosRemotosObj) {
                console.log('Usando dados remotos (únicos disponíveis)');
                dadosSistema = dadosRemotosObj;
            } else {
                console.log('Nenhum dado encontrado, usando dados iniciais');
                inicializarDadosPadrao();
            }
            
            // Atualizar dados do dispositivo atual
            atualizarPresencaDispositivo();
            
            // Salvar cópia local
            salvarDadosLocal();
            
            atualizarInfoSincronizacao();
        }

        // Função para salvar dados localmente
        function salvarDadosLocal() {
            dadosSistema.ultimaSincronizacao = new Date().toISOString();
            localStorage.setItem(CONFIG.APP_NAME + '_dados', JSON.stringify(dadosSistema));
            console.log('Dados salvos localmente:', new Date().toLocaleString());
        }

        // Função para sincronizar entre abas/dispositivos
        function sincronizarDados() {
            try {
                // Mostrar status de sincronização
                mostrarStatusSincronizacao('Sincronizando...', 'syncing');
                
                // Atualizar timestamp
                dadosSistema.ultimaSincronizacao = new Date().toISOString();
                
                // Atualizar presença do dispositivo
                atualizarPresencaDispositivo();
                
                // Salvar localmente
                salvarDadosLocal();
                
                // Salvar para sincronização com outras abas/dispositivos
                localStorage.setItem(CONFIG.APP_NAME + '_dados_sincronizados', JSON.stringify(dadosSistema));
                
                // Disparar evento para outras abas
                localStorage.setItem(CONFIG.APP_NAME + '_sync_trigger', Date.now().toString());
                
                console.log('Dados sincronizados:', dadosSistema.ultimaSincronizacao);
                
                // Atualizar informações na tela
                atualizarInfoSincronizacao();
                
                // Mostrar status de sucesso
                mostrarStatusSincronizacao('Sincronizado', 'synced');
                
                return true;
            } catch (error) {
                console.error('Erro na sincronização:', error);
                mostrarStatusSincronizacao('Erro na sincronização', 'error');
                return false;
            }
        }

        // Atualizar presença do dispositivo
        function atualizarPresencaDispositivo() {
            if (!dadosSistema.dispositivoAtual) return;
            
            const dispositivoIndex = dadosSistema.dispositivosConectados.findIndex(
                d => d.id === dadosSistema.dispositivoAtual.id
            );
            
            dadosSistema.dispositivoAtual.ultimoAcesso = new Date().toISOString();
            
            if (dispositivoIndex === -1) {
                dadosSistema.dispositivosConectados.push({...dadosSistema.dispositivoAtual});
            } else {
                dadosSistema.dispositivosConectados[dispositivoIndex] = {...dadosSistema.dispositivoAtual};
            }
            
            // Limpar dispositivos inativos (mais de 1 hora)
            const umaHoraAtras = new Date(Date.now() - 3600000).toISOString();
            dadosSistema.dispositivosConectados = dadosSistema.dispositivosConectados.filter(
                d => d.ultimoAcesso > umaHoraAtras
            );
        }

        // Ouvir eventos de sincronização de outras abas
        function configurarOuvinteSincronizacao() {
            window.addEventListener('storage', function(event) {
                if (event.key === CONFIG.APP_NAME + '_sync_trigger') {
                    console.log('Recebida notificação de sincronização de outra aba');
                    
                    // Aguardar um pouco para garantir que os dados foram salvos
                    setTimeout(() => {
                        const dadosRemotos = localStorage.getItem(CONFIG.APP_NAME + '_dados_sincronizados');
                        if (dadosRemotos) {
                            try {
                                const dadosRemotosObj = JSON.parse(dadosRemotos);
                                const dataLocal = new Date(dadosSistema.ultimaSincronizacao || 0);
                                const dataRemoto = new Date(dadosRemotosObj.ultimaSincronizacao || 0);
                                
                                if (dataRemoto > dataLocal) {
                                    console.log('Atualizando dados da outra aba');
                                    dadosSistema = dadosRemotosObj;
                                    
                                    // Atualizar UI
                                    if (isLoggedIn) {
                                        atualizarTodasTelas();
                                    }
                                    
                                    mostrarStatusSincronizacao('Dados atualizados!', 'synced');
                                    showNotification('Dados sincronizados de outro dispositivo!', 'success');
                                }
                            } catch (error) {
                                console.error('Erro ao processar dados da outra aba:', error);
                            }
                        }
                    }, 100);
                }
            });
        }

        // Inicializar dados padrão se não houver dados salvos
        function inicializarDadosPadrao() {
            console.log('Inicializando dados padrão...');
            
            // Registros iniciais (87 registros originais)
            dadosSistema.registros = [
                { id: 1, equipamento: "teclado", quantidade: 1, local: "PSF Padre Chico", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 2, equipamento: "teclado", quantidade: 1, local: "PSF Santana", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 3, equipamento: "teclado", quantidade: 1, local: "PSF Vila Nova", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 4, equipamento: "mouse", quantidade: 1, local: "PSF Padre Chico", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 5, equipamento: "mouse", quantidade: 1, local: "PSF Santana", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 6, equipamento: "mouse", quantidade: 1, local: "PSF Vila Nova", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 7, equipamento: "filtro de linha", quantidade: 1, local: "PSF Padre Chico", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 8, equipamento: "filtro de linha", quantidade: 1, local: "PSF Santana", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 9, equipamento: "cabo VGA", quantidade: 1, local: "PSF Padre Chico", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 10, equipamento: "cabo de força", quantidade: 2, local: "PSF Padre Chico", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 11, equipamento: "cabo VGA", quantidade: 1, local: "PSF Santana", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 12, equipamento: "cabo de força", quantidade: 2, local: "PSF Santana", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 13, equipamento: "cabo VGA", quantidade: 1, local: "PSF Vila Nova", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 14, equipamento: "cabo de força", quantidade: 2, local: "PSF Vila Nova", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 15, equipamento: "monitor", quantidade: 1, local: "PSF Padre Chico", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 16, equipamento: "monitor", quantidade: 1, local: "PSF Santana", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 17, equipamento: "monitor", quantidade: 1, local: "PSF Vila Nova", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 18, equipamento: "monitor", quantidade: 1, local: "PSF São José", data: "2025-06-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 19, equipamento: "mouse", quantidade: 1, local: "Secretaria de Agricultura", data: "2025-06-03", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 20, equipamento: "cabo VGA", quantidade: 1, local: "PSF Central", data: "2025-06-03", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 21, equipamento: "cabo de força", quantidade: 2, local: "PSF Central", data: "2025-06-05", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 22, equipamento: "teclado", quantidade: 1, local: "PSF Central", data: "2025-06-05", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 23, equipamento: "mouse", quantidade: 1, local: "PSF Central", data: "2025-06-05", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 24, equipamento: "filtro de linha", quantidade: 1, local: "PSF Central", data: "2025-06-05", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 25, equipamento: "tinta impressora Epson", quantidade: 4, local: "Creche São José 1", data: "2025-06-06", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 26, equipamento: "tinta impressora Epson", quantidade: 2, local: "Lucas", data: "2025-06-06", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 27, equipamento: "cabo VGA", quantidade: 1, local: "Secretaria da Agricultura", data: "2025-06-06", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 28, equipamento: "cabo de força", quantidade: 2, local: "Secretaria da Agricultura", data: "2025-06-06", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 29, equipamento: "mouse", quantidade: 1, local: "Secretaria da Agricultura", data: "2025-06-06", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 30, equipamento: "mouse", quantidade: 2, local: "Sala de Informática - São Tarcísio", data: "2025-06-09", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 31, equipamento: "toner impressora HP", quantidade: 1, local: "PSF Padre Chico", data: "2025-06-12", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 32, equipamento: "mouse", quantidade: 1, local: "Delegacia Civil", data: "2025-06-16", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 33, equipamento: "teclado", quantidade: 1, local: "Delegacia Civil", data: "2025-06-16", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 34, equipamento: "teclado", quantidade: 1, local: "Sala de Licitação", data: "2025-06-24", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 35, equipamento: "mouse", quantidade: 1, local: "Sala de Licitação", data: "2025-06-24", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 36, equipamento: "pendrive", quantidade: 1, local: "Lucas", data: "2025-06-24", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 37, equipamento: "filtro de linha", quantidade: 1, local: "Sabrina", data: "2025-06-24", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 38, equipamento: "filtro de linha", quantidade: 1, local: "Evinho", data: "2025-06-24", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 39, equipamento: "filtro de linha", quantidade: 1, local: "Setor Licitação", data: "2025-06-24", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 40, equipamento: "pendrive", quantidade: 1, local: "PSF Vacina", data: "2025-06-27", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 41, equipamento: "mouse", quantidade: 1, local: "Sala de Compras", data: "2025-07-07", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 42, equipamento: "tinta impressora Epson", quantidade: 4, local: "EM Vila Nova", data: "2025-07-07", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 43, equipamento: "filtro de linha", quantidade: 1, local: "Conselho Tutelar", data: "2025-07-07", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 44, equipamento: "pendrive", quantidade: 3, local: "Gabinete", data: "2025-07-08", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 45, equipamento: "pendrive", quantidade: 1, local: "EM Elisa Rabelo", data: "2025-07-08", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 46, equipamento: "adaptador HDMI para VGA", quantidade: 1, local: "PSF Santana", data: "2025-07-09", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 47, equipamento: "cabo VGA", quantidade: 1, local: "PSF Santana", data: "2025-07-09", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 48, equipamento: "teclado", quantidade: 1, local: "Biblioteca", data: "2025-07-09", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 49, equipamento: "mouse", quantidade: 1, local: "Biblioteca", data: "2025-07-09", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 50, equipamento: "filtro de linha", quantidade: 2, local: "Biblioteca", data: "2025-07-09", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 51, equipamento: "mouse", quantidade: 1, local: "Creche Vila Nova", data: "2025-07-17", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 52, equipamento: "adaptador Wi-Fi", quantidade: 1, local: "PSF Santana", data: "2025-07-17", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 53, equipamento: "adaptador Wi-Fi", quantidade: 1, local: "Secretaria de Agricultura", data: "2025-07-18", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 54, equipamento: "mouse", quantidade: 2, local: "Secretaria de Agricultura", data: "2025-07-18", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 55, equipamento: "pendrive", quantidade: 2, local: "Secretaria de Saúde", data: "2025-07-28", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 56, equipamento: "tinta impressora Epson", quantidade: 4, local: "Creche Vila Nova", data: "2025-07-31", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 57, equipamento: "pendrive", quantidade: 1, local: "João Torres", data: "2025-08-11", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 58, equipamento: "tinta impressora", quantidade: 4, local: "E. José Rodrigues", data: "2025-08-18", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 59, equipamento: "cabo de alimentação", quantidade: 1, local: "Vigilância Dengue", data: "2025-08-18", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 60, equipamento: "cabo USB impressora", quantidade: 1, local: "PSF Padre Chico", data: "2025-08-18", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 61, equipamento: "cabo força impressora", quantidade: 1, local: "EM São Tarcísio", data: "2025-08-19", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 62, equipamento: "mouse", quantidade: 1, local: "EM São Tarcísio", data: "2025-08-22", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 63, equipamento: "mouse", quantidade: 1, local: "Maycon", data: "2025-08-25", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 64, equipamento: "pendrive", quantidade: 1, local: "Gustavo", data: "2025-08-26", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 65, equipamento: "pendrive", quantidade: 1, local: "João Scatolino", data: "2025-08-26", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 66, equipamento: "cabo HDMI", quantidade: 1, local: "João Scatolino", data: "2025-08-28", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 67, equipamento: "teclado", quantidade: 1, local: "Fabio", data: "2025-08-29", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 68, equipamento: "pendrive", quantidade: 1, local: "Elis", data: "2025-08-29", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 69, equipamento: "switch", quantidade: 1, local: "Lucas", data: "2025-08-29", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 70, equipamento: "mouse", quantidade: 1, local: "EM Carmen Rocha", data: "2025-09-02", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 71, equipamento: "teclado", quantidade: 1, local: "Silvinha RH", data: "2025-09-03", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 72, equipamento: "roteador", quantidade: 1, local: "Secretaria de Lazer e Turismo", data: "2025-09-04", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 73, equipamento: "teclado", quantidade: 1, local: "CRAS", data: "2025-09-25", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 74, equipamento: "pendrive", quantidade: 5, local: "Licitação", data: "2025-09-15", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 75, equipamento: "mouse", quantidade: 1, local: "Licitação", data: "2025-09-15", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 76, equipamento: "mouse", quantidade: 4, local: "EM São Tarcísio", data: "2025-09-19", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 77, equipamento: "tinta impressora Canon", quantidade: 4, local: "EM São Tarcísio", data: "2025-10-01", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 78, equipamento: "tinta impressora Epson", quantidade: 4, local: "Ângela Torres", data: "2025-10-07", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 79, equipamento: "tinta impressora Epson L3250", quantidade: 1, local: "Conselho Tutelar", data: "2025-10-09", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 80, equipamento: "teclado", quantidade: 2, local: "Vampirinho", data: "2025-10-17", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 81, equipamento: "pendrive", quantidade: 1, local: "Jurídico", data: "2025-10-23", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 82, equipamento: "mouse", quantidade: 2, local: "São Tarcísio", data: "2025-10-30", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 83, equipamento: "cabo impressora", quantidade: 1, local: "Pâmela", data: "2025-11-05", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 84, equipamento: "roteador", quantidade: 1, local: "Maycon", data: "2025-11-11", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 85, equipamento: "mouse", quantidade: 1, local: "Pâmela", data: "2025-11-18", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 86, equipamento: "mouse", quantidade: 1, local: "EM São Tarcísio", data: "2025-11-24", responsavel: "Não especificado", telefone: "(  ) _____" },
                { id: 87, equipamento: "toner", quantidade: 1, local: "São Tarcísio", data: "2025-11-27", responsavel: "Não especificado", telefone: "(  ) _____" }
            ];
            
            // Estoque inicial baseado nos registros
            dadosSistema.estoque = {
                teclado: { nome: "Teclado", quantidade: 10, minimo: 3, categoria: "teclado", icone: "fa-keyboard" },
                mouse: { nome: "Mouse", quantidade: 8, minimo: 5, categoria: "mouse", icone: "fa-computer-mouse" },
                monitor: { nome: "Monitor", quantidade: 3, minimo: 2, categoria: "monitor", icone: "fa-desktop" },
                "filtro de linha": { nome: "Filtro de Linha", quantidade: 2, minimo: 3, categoria: "filtro", icone: "fa-plug" },
                "cabo vga": { nome: "Cabo VGA", quantidade: 2, minimo: 2, categoria: "cabo", icone: "fa-cable" },
                "cabo de força": { nome: "Cabo de Força", quantidade: 3, minimo: 3, categoria: "cabo", icone: "fa-plug" },
                "tinta impressora epson": { nome: "Tinta Impressora Epson", quantidade: 5, minimo: 4, categoria: "tinta", icone: "fa-print" },
                "tinta impressora canon": { nome: "Tinta Impressora Canon", quantidade: 2, minimo: 2, categoria: "tinta", icone: "fa-print" },
                "tinta impressora": { nome: "Tinta Impressora", quantidade: 3, minimo: 3, categoria: "tinta", icone: "fa-print" },
                pendrive: { nome: "Pendrive", quantidade: 4, minimo: 5, categoria: "pendrive", icone: "fa-usb" },
                "adaptador hdmi para vga": { nome: "Adaptador HDMI para VGA", quantidade: 1, minimo: 1, categoria: "adaptador", icone: "fa-hdmi" },
                "adaptador wi-fi": { nome: "Adaptador Wi-Fi", quantidade: 1, minimo: 1, categoria: "adaptador", icone: "fa-wifi" },
                "cabo hdmi": { nome: "Cabo HDMI", quantidade: 1, minimo: 1, categoria: "cabo", icone: "fa-hdmi" },
                "cabo usb impressora": { nome: "Cabo USB Impressora", quantidade: 1, minimo: 1, categoria: "cabo", icone: "fa-usb" },
                "cabo força impressora": { nome: "Cabo Força Impressora", quantidade: 1, minimo: 1, categoria: "cabo", icone: "fa-plug" },
                "cabo de alimentação": { nome: "Cabo de Alimentação", quantidade: 1, minimo: 1, categoria: "cabo", icone: "fa-plug" },
                "cabo impressora": { nome: "Cabo Impressora", quantidade: 1, minimo: 1, categoria: "cabo", icone: "fa-cable" },
                "toner impressora hp": { nome: "Toner Impressora HP", quantidade: 1, minimo: 1, categoria: "toner", icone: "fa-print" },
                toner: { nome: "Toner", quantidade: 1, minimo: 1, categoria: "toner", icone: "fa-print" },
                switch: { nome: "Switch", quantidade: 1, minimo: 1, categoria: "switch", icone: "fa-network-wired" },
                roteador: { nome: "Roteador", quantidade: 1, minimo: 1, categoria: "roteador", icone: "fa-router" },
                "tinta impressora epson l3250": { nome: "Tinta Impressora Epson L3250", quantidade: 1, minimo: 1, categoria: "tinta", icone: "fa-print" }
            };
            
            // Tipos de locais
            dadosSistema.tiposLocais = [
                "PSF Padre Chico", "PSF Santana", "PSF Vila Nova", "PSF Central", "PSF São José",
                "Secretaria de Agricultura", "Secretaria da Agricultura", "Sala de Informática - São Tarcísio",
                "Delegacia Civil", "Sala de Licitação", "Sabrina", "Evinho", "Setor Licitação",
                "PSF Vacina", "Sala de Compras", "EM Vila Nova", "Conselho Tutelar", "Gabinete",
                "EM Elisa Rabelo", "Biblioteca", "Creche Vila Nova", "Secretaria de Saúde",
                "Creche São José 1", "Lucas", "João Torres", "E. José Rodrigues", "Vigilância Dengue",
                "EM São Tarcísio", "Maycon", "Gustavo", "João Scatolino", "Fabio", "Elis",
                "EM Carmen Rocha", "Silvinha RH", "Secretaria de Lazer e Turismo", "CRAS",
                "Licitação", "Ângela Torres", "Vampirinho", "Jurídico", "São Tarcísio", "Pâmela"
            ];
            
            // Termos de aquisição vazios
            dadosSistema.termosAquisicao = [];
            
            // Dispositivos conectados
            dadosSistema.dispositivosConectados = [];
            
            // Timestamp
            dadosSistema.ultimaSincronizacao = new Date().toISOString();
        }

        // ==============================================
        // FUNÇÕES AUXILIARES
        // ==============================================

        // Mostrar status de sincronização
        function mostrarStatusSincronizacao(texto, tipo = 'synced') {
            const syncStatus = document.getElementById('syncStatus');
            const syncText = document.getElementById('syncText');
            
            if (syncStatus && syncText) {
                syncText.textContent = texto;
                syncStatus.className = 'sync-status visible ' + tipo;
                
                // Ocultar após 3 segundos se for sucesso
                if (tipo === 'synced') {
                    setTimeout(() => {
                        syncStatus.classList.remove('visible');
                    }, 3000);
                }
            }
        }

        // Atualizar informações de sincronização
        function atualizarInfoSincronizacao() {
            document.getElementById('device-id-info').textContent = 
                dadosSistema.dispositivoAtual?.id || 'Não identificado';
            
            document.getElementById('last-sync-info').textContent = 
                dadosSistema.ultimaSincronizacao ? 
                new Date(dadosSistema.ultimaSincronizacao).toLocaleString('pt-BR') : 
                'Nunca sincronizado';
            
            document.getElementById('active-devices-info').textContent = 
                dadosSistema.dispositivosConectados?.length || 0;
        }

        // Atualizar todas as telas
        function atualizarTodasTelas() {
            loadDashboard();
            loadEstatisticas();
            loadConsultar();
            loadEstoqueTable();
            loadConfiguracoes();
            atualizarContadorTermos();
        }

        // ==============================================
        // FUNÇÕES EXISTENTES DO SISTEMA (COM SINCRONIZAÇÃO)
        // ==============================================

        // Função para atualizar data e hora
        function updateDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('pt-BR', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const timeStr = now.toLocaleTimeString('pt-BR');
            
            document.getElementById('date-display').textContent = dateStr;
            document.getElementById('time-display').textContent = timeStr;
            document.getElementById('footer-time').textContent = `Última atualização: ${timeStr}`;
        }

        // Função para mostrar notificação
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                padding: 15px 20px;
                background: ${type === 'success' ? '#10b981' : type === 'danger' ? '#ef4444' : '#3b82f6'};
                color: white;
                border-radius: 10px;
                box-shadow: 0 10px 25px -5px rgba(0,0,0,0.2);
                z-index: 1000;
                display: flex;
                justify-content: space-between;
                align-items: center;
                min-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            
            notification.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;">×</button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // Função para formatar texto
        function formatText(text) {
            if (!text) return '';
            return text
                .toString()
                .replace(/_/g, ' ')
                .replace(/\b\w/g, char => char.toUpperCase())
                .replace(/([a-z])([A-Z])/g, '$1 $2');
        }

        // Função para formatar valor monetário
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        // Configurar sistema de login
        function setupLoginSystem() {
            const loginForm = document.getElementById('loginForm');
            const logoutBtn = document.getElementById('logoutBtn');
            
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                const usuario = usuariosAutorizados.find(u => 
                    u.username === username && u.password === password
                );
                
                if (usuario) {
                    usuarioLogado = usuario;
                    isLoggedIn = true;
                    
                    document.getElementById('loginOverlay').style.display = 'none';
                    document.getElementById('userStatus').style.display = 'flex';
                    document.getElementById('loggedUser').textContent = usuario.nome;
                    
                    showNotification(`Bem-vindo, ${usuario.nome}!`, 'success');
                    updateUIForLogin();
                } else {
                    showNotification('Usuário ou senha incorretos!', 'danger');
                }
            });
            
            logoutBtn.addEventListener('click', function() {
                usuarioLogado = null;
                isLoggedIn = false;
                
                document.getElementById('loginOverlay').style.display = 'flex';
                document.getElementById('userStatus').style.display = 'none';
                
                showNotification('Você saiu do sistema.', 'success');
                updateUIForLogout();
            });
        }

        // Atualizar UI para login
        function updateUIForLogin() {
            document.getElementById('addProductBtn').style.display = 'flex';
            const buttons = document.querySelectorAll('.btn-primary, .btn-success, .btn-danger');
            buttons.forEach(btn => btn.disabled = false);
            atualizarContadorTermos();
        }

        // Atualizar UI para logout
        function updateUIForLogout() {
            document.getElementById('addProductBtn').style.display = 'none';
            const buttons = document.querySelectorAll('.btn-primary, .btn-success, .btn-danger');
            buttons.forEach(btn => btn.disabled = true);
        }

        // Configurar navegação
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.section');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remover active de todos
                    navLinks.forEach(l => l.classList.remove('active'));
                    sections.forEach(s => s.classList.remove('active'));
                    
                    // Adicionar active ao clicado
                    this.classList.add('active');
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                    
                    // Executar ações específicas
                    switch(sectionId) {
                        case 'home':
                            loadDashboard();
                            break;
                        case 'registrar':
                            setupRegistroForm();
                            break;
                        case 'consultar':
                            loadConsultar();
                            break;
                        case 'estatisticas':
                            loadEstatisticas();
                            break;
                        case 'termo-aquisicao':
                            setupTermoForm();
                            break;
                        case 'estoque':
                            loadEstoqueTable();
                            break;
                        case 'configuracoes':
                            loadConfiguracoes();
                            break;
                    }
                });
            });
        }

        // Carregar dashboard
        function loadDashboard() {
            const totalItens = dadosSistema.registros.reduce((sum, r) => sum + r.quantidade, 0);
            
            // Contar equipamentos distintos
            const equipamentosDistintos = [...new Set(dadosSistema.registros.map(r => r.equipamento))].length;
            
            // Contar locais distintos
            const locaisDistintos = [...new Set(dadosSistema.registros.map(r => r.local))].length;
            
            document.getElementById('total-itens').textContent = totalItens;
            document.getElementById('total-registros').textContent = dadosSistema.registros.length;
            document.getElementById('tipos-equipamentos').textContent = equipamentosDistintos;
            document.getElementById('total-locais').textContent = locaisDistintos;
            
            // Atualizar atividade recente - ORDENADO POR DATA MAIS RECENTE
            const activityList = document.getElementById('recent-activity-list');
            activityList.innerHTML = '';
            
            // Ordenar registros por data (mais recente primeiro)
            const registrosOrdenados = [...dadosSistema.registros].sort((a, b) => {
                return new Date(b.data) - new Date(a.data);
            });
            
            // Pegar apenas os 10 mais recentes
            const recentes = registrosOrdenados.slice(0, 10);
            
            recentes.forEach(registro => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <div class="activity-icon">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="activity-details">
                        <h4>${registro.quantidade}x ${dadosSistema.estoque[registro.equipamento.toLowerCase()]?.nome || formatText(registro.equipamento)}</h4>
                        <p>${registro.local} - ${new Date(registro.data).toLocaleDateString('pt-BR')}</p>
                    </div>
                `;
                activityList.appendChild(item);
            });
            
            // Atualizar contador de atividades
            document.getElementById('activity-count').textContent = recentes.length;
        }

        // Configurar formulário de registro
        function setupRegistroForm() {
            // Configurar data atual
            document.getElementById('data').value = new Date().toISOString().split('T')[0];
            
            // Configurar envio do formulário
            const form = document.getElementById('registro-form');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!isLoggedIn) {
                    showNotification('Faça login para salvar registros!', 'danger');
                    return;
                }
                
                const equipamento = document.getElementById('equipamento').value.trim();
                const quantidade = parseInt(document.getElementById('quantidade').value);
                const local = document.getElementById('local').value.trim();
                const data = document.getElementById('data').value;
                const responsavel = document.getElementById('responsavel').value;
                const telefone = document.getElementById('telefone-responsavel').value;
                const email = document.getElementById('email-responsavel').value;
                const observacoes = document.getElementById('observacoes').value;
                
                if (!equipamento || !quantidade || !local || !data || !responsavel || !telefone) {
                    showNotification('Preencha todos os campos obrigatórios!', 'danger');
                    return;
                }
                
                // Normalizar o nome do equipamento
                const equipamentoKey = equipamento.toLowerCase();
                
                // Verificar estoque apenas se o equipamento existir
                if (dadosSistema.estoque[equipamentoKey] && dadosSistema.estoque[equipamentoKey].quantidade < quantidade) {
                    showNotification(`Estoque insuficiente! Disponível: ${dadosSistema.estoque[equipamentoKey].quantidade}`, 'danger');
                    return;
                }
                
                // Gerar ID único baseado no maior ID existente + 1
                const maxId = dadosSistema.registros.length > 0 ? Math.max(...dadosSistema.registros.map(r => r.id)) : 0;
                const novoId = maxId + 1;
                
                // Criar registro
                const novoRegistro = {
                    id: novoId,
                    equipamento: equipamentoKey,
                    equipamentoOriginal: equipamento,
                    quantidade: quantidade,
                    local: local,
                    data: data,
                    responsavel: responsavel,
                    telefone: telefone,
                    email: email || '',
                    observacoes: observacoes || ''
                };
                
                // Adicionar aos registros (no início para ser mais recente primeiro)
                dadosSistema.registros.unshift(novoRegistro);
                
                // Atualizar estoque apenas se o equipamento existir
                if (dadosSistema.estoque[equipamentoKey]) {
                    dadosSistema.estoque[equipamentoKey].quantidade -= quantidade;
                }
                
                // Adicionar local se não existir
                if (!dadosSistema.tiposLocais.includes(local)) {
                    dadosSistema.tiposLocais.push(local);
                }
                
                // Salvar e mostrar mensagem
                sincronizarDados();
                showNotification('Registro salvo com sucesso!', 'success');
                
                // Limpar formulário
                form.reset();
                document.getElementById('data').value = new Date().toISOString().split('T')[0];
                
                // Atualizar dashboard e estatísticas
                loadDashboard();
                loadEstatisticas();
                loadConsultar();
                loadEstoqueTable();
            });
        }

        // Função para excluir um registro
        function excluirRegistro(id) {
            if (!isLoggedIn) {
                showNotification('Faça login para excluir registros!', 'danger');
                return;
            }
            
            const registroIndex = dadosSistema.registros.findIndex(r => r.id === id);
            
            if (registroIndex === -1) {
                showNotification('Registro não encontrado!', 'danger');
                return;
            }
            
            const registro = dadosSistema.registros[registroIndex];
            
            if (!confirm(`Tem certeza que deseja excluir o registro ${id}?\n${registro.quantidade}x ${registro.equipamentoOriginal || formatText(registro.equipamento)}`)) {
                return;
            }
            
            // Restaurar estoque se o equipamento existir
            if (dadosSistema.estoque[registro.equipamento]) {
                dadosSistema.estoque[registro.equipamento].quantidade += registro.quantidade;
            }
            
            // Remover registro
            dadosSistema.registros.splice(registroIndex, 1);
            
            // Salvar dados
            sincronizarDados();
            
            // Atualizar interface
            loadDashboard();
            loadEstatisticas();
            loadConsultar();
            loadEstoqueTable();
            
            showNotification('Registro excluído com sucesso!', 'success');
        }

        // Carregar consulta
        function loadConsultar() {
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = '';
            
            // Ordenar registros por data (mais recente primeiro)
            const registrosOrdenados = [...dadosSistema.registros].sort((a, b) => {
                return new Date(b.data) - new Date(a.data);
            });
            
            registrosOrdenados.forEach(registro => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${registro.id}</td>
                    <td>${dadosSistema.estoque[registro.equipamento]?.nome || formatText(registro.equipamento)}</td>
                    <td>${registro.quantidade}</td>
                    <td>${registro.local}</td>
                    <td>${new Date(registro.data).toLocaleDateString('pt-BR')}</td>
                    <td>${registro.responsavel || '-'}</td>
                    <td>${registro.telefone || '-'}</td>
                    <td class="acoes-cell">
                        <button class="btn-small btn-danger" onclick="excluirRegistro(${registro.id})" ${!isLoggedIn ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Atualizar contador de registros
            document.getElementById('total-registros-consulta').textContent = dadosSistema.registros.length;
            
            // Configurar busca
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            const clearBtn = document.getElementById('clear-search');
            
            searchBtn.addEventListener('click', function() {
                const term = searchInput.value.toLowerCase();
                const rows = tableBody.querySelectorAll('tr');
                let encontrados = 0;
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    if (text.includes(term)) {
                        row.style.display = '';
                        encontrados++;
                    } else {
                        row.style.display = 'none';
                    }
                });
                
                showNotification(`${encontrados} registros encontrados para "${searchInput.value}"`, 'info');
            });
            
            clearBtn.addEventListener('click', function() {
                searchInput.value = '';
                const rows = tableBody.querySelectorAll('tr');
                rows.forEach(row => row.style.display = '');
                showNotification(`Mostrando todos os ${dadosSistema.registros.length} registros`, 'info');
            });
        }

        // Carregar estatísticas
        function loadEstatisticas() {
            if (dadosSistema.registros.length === 0) {
                document.getElementById('top-locais').innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">Nenhum registro encontrado</p>';
                document.getElementById('top-equipamentos').innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">Nenhum registro encontrado</p>';
                document.getElementById('estatisticas-mes').innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">Nenhum registro encontrado</p>';
                return;
            }
            
            // 1. Estatísticas por Local (onde foi mais produto)
            const estatisticasLocais = {};
            dadosSistema.registros.forEach(registro => {
                const local = registro.local;
                if (!estatisticasLocais[local]) {
                    estatisticasLocais[local] = {
                        quantidade: 0,
                        registros: 0
                    };
                }
                estatisticasLocais[local].quantidade += registro.quantidade;
                estatisticasLocais[local].registros++;
            });
            
            // Converter para array e ordenar por quantidade (maior primeiro)
            const locaisOrdenados = Object.entries(estatisticasLocais)
                .map(([local, dados]) => ({
                    local,
                    quantidade: dados.quantidade,
                    registros: dados.registros
                }))
                .sort((a, b) => b.quantidade - a.quantidade)
                .slice(0, 10);
            
            // Calcular máximo para progress bar
            const maxLocal = locaisOrdenados.length > 0 ? locaisOrdenados[0].quantidade : 1;
            
            // Renderizar top locais
            const topLocaisElement = document.getElementById('top-locais');
            topLocaisElement.innerHTML = '';
            
            locaisOrdenados.forEach((item, index) => {
                const porcentagem = (item.quantidade / maxLocal) * 100;
                const li = document.createElement('div');
                li.className = 'top-item';
                li.innerHTML = `
                    <div class="top-info">
                        <div class="top-rank">${index + 1}</div>
                        <div class="top-details">
                            <h5>${item.local}</h5>
                            <p>${item.registros} registro(s)</p>
                        </div>
                    </div>
                    <div>
                        <div class="top-value">${item.quantidade} un.</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${porcentagem}%"></div>
                        </div>
                    </div>
                `;
                topLocaisElement.appendChild(li);
            });
            
            // 2. Estatísticas por Equipamento (mais utilizados)
            const estatisticasEquipamentos = {};
            dadosSistema.registros.forEach(registro => {
                const equipamento = registro.equipamento;
                if (!estatisticasEquipamentos[equipamento]) {
                    estatisticasEquipamentos[equipamento] = {
                        quantidade: 0,
                        registros: 0,
                        nome: dadosSistema.estoque[equipamento]?.nome || formatText(equipamento)
                    };
                }
                estatisticasEquipamentos[equipamento].quantidade += registro.quantidade;
                estatisticasEquipamentos[equipamento].registros++;
            });
            
            // Converter para array e ordenar por quantidade (maior primeiro)
            const equipamentosOrdenados = Object.entries(estatisticasEquipamentos)
                .map(([equipamento, dados]) => ({
                    equipamento,
                    nome: dados.nome,
                    quantidade: dados.quantidade,
                    registros: dados.registros
                }))
                .sort((a, b) => b.quantidade - a.quantidade)
                .slice(0, 10);
            
            // Calcular máximo para progress bar
            const maxEquipamento = equipamentosOrdenados.length > 0 ? equipamentosOrdenados[0].quantidade : 1;
            
            // Renderizar top equipamentos
            const topEquipamentosElement = document.getElementById('top-equipamentos');
            topEquipamentosElement.innerHTML = '';
            
            equipamentosOrdenados.forEach((item, index) => {
                const porcentagem = (item.quantidade / maxEquipamento) * 100;
                const li = document.createElement('div');
                li.className = 'top-item';
                li.innerHTML = `
                    <div class="top-info">
                        <div class="top-rank">${index + 1}</div>
                        <div class="top-details">
                            <h5>${item.nome}</h5>
                            <p>${item.registros} registro(s)</p>
                        </div>
                    </div>
                    <div>
                        <div class="top-value">${item.quantidade} un.</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${porcentagem}%"></div>
                        </div>
                    </div>
                `;
                topEquipamentosElement.appendChild(li);
            });
            
            // 3. Estatísticas por Mês
            const estatisticasMeses = {};
            dadosSistema.registros.forEach(registro => {
                const data = new Date(registro.data);
                const mesAno = `${data.getMonth() + 1}/${data.getFullYear()}`;
                const mesNome = data.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
                
                if (!estatisticasMeses[mesAno]) {
                    estatisticasMeses[mesAno] = {
                        nome: mesNome,
                        quantidade: 0,
                        registros: 0
                    };
                }
                estatisticasMeses[mesAno].quantidade += registro.quantidade;
                estatisticasMeses[mesAno].registros++;
            });
            
            // Converter para array e ordenar por mês (mais recente primeiro)
            const mesesOrdenados = Object.entries(estatisticasMeses)
                .map(([mesAno, dados]) => ({
                    mesAno,
                    nome: dados.nome,
                    quantidade: dados.quantidade,
                    registros: dados.registros
                }))
                .sort((a, b) => {
                    const [mesA, anoA] = a.mesAno.split('/').map(Number);
                    const [mesB, anoB] = b.mesAno.split('/').map(Number);
                    if (anoB !== anoA) return anoB - anoA;
                    return mesB - mesA;
                })
                .slice(0, 6);
            
            // Calcular máximo para progress bar
            const maxMes = mesesOrdenados.length > 0 ? Math.max(...mesesOrdenados.map(m => m.quantidade)) : 1;
            
            // Renderizar estatísticas por mês
            const estatisticasMesElement = document.getElementById('estatisticas-mes');
            estatisticasMesElement.innerHTML = '';
            
            mesesOrdenados.forEach((item) => {
                const porcentagem = (item.quantidade / maxMes) * 100;
                const li = document.createElement('div');
                li.className = 'top-item';
                li.innerHTML = `
                    <div class="top-info">
                        <div class="top-details">
                            <h5>${item.nome}</h5>
                            <p>${item.registros} registro(s)</p>
                        </div>
                    </div>
                    <div>
                        <div class="top-value">${item.quantidade} un.</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${porcentagem}%"></div>
                        </div>
                    </div>
                `;
                estatisticasMesElement.appendChild(li);
            });
            
            // 4. Estatísticas Gerais
            const totalQuantidade = dadosSistema.registros.reduce((sum, r) => sum + r.quantidade, 0);
            const mediaQuantidade = dadosSistema.registros.length > 0 ? (totalQuantidade / dadosSistema.registros.length).toFixed(1) : 0;
            
            // Contar dias distintos com registros
            const diasUnicos = new Set(dadosSistema.registros.map(r => r.data));
            const totalDias = diasUnicos.size;
            
            // Contar locais distintos
            const locaisUnicos = new Set(dadosSistema.registros.map(r => r.local));
            const totalLocais = locaisUnicos.size;
            
            // Contar equipamentos distintos
            const equipamentosUnicos = new Set(dadosSistema.registros.map(r => r.equipamento));
            const totalEquipamentos = equipamentosUnicos.size;
            
            // Atualizar estatísticas gerais
            document.getElementById('media-quantidade').textContent = mediaQuantidade;
            document.getElementById('dias-registros').textContent = `${totalDias} dia(s)`;
            document.getElementById('locais-distintos').textContent = `${totalLocais} local(is)`;
            document.getElementById('equipamentos-distintos').textContent = `${totalEquipamentos} tipo(s)`;
            
            // Atualizar progress bars (usando valores relativos)
            const maxMedia = Math.max(mediaQuantidade, 5);
            const maxDias = Math.max(totalDias, 10);
            const maxLocais = Math.max(totalLocais, 10);
            const maxEquipamentos = Math.max(totalEquipamentos, 10);
            
            document.getElementById('progress-media').style.width = `${(mediaQuantidade / maxMedia) * 100}%`;
            document.getElementById('progress-dias').style.width = `${(totalDias / maxDias) * 100}%`;
            document.getElementById('progress-locais').style.width = `${(totalLocais / maxLocais) * 100}%`;
            document.getElementById('progress-equipamentos').style.width = `${(totalEquipamentos / maxEquipamentos) * 100}%`;
        }

        // Configurar sistema de assinatura
        function setupAssinaturaSystem() {
            canvas = document.getElementById('assinaturaCanvas');
            if (!canvas) return;
            
            ctx = canvas.getContext('2d');
            
            // Configurar estilo do desenho
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Eventos para desenho
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Eventos para touch (dispositivos móveis)
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });
            
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });
            
            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                const mouseEvent = new MouseEvent('mouseup', {});
                canvas.dispatchEvent(mouseEvent);
            });
            
            // Botão de limpar assinatura
            document.getElementById('limparAssinatura')?.addEventListener('click', function() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                assinaturaDataURL = null;
                updateAssinaturaPreview();
            });
            
            // Botão de salvar assinatura
            document.getElementById('salvarAssinatura')?.addEventListener('click', function() {
                assinaturaDataURL = canvas.toDataURL('image/png');
                updateAssinaturaPreview();
                showNotification('Assinatura salva com sucesso!', 'success');
            });
            
            // Upload de imagem
            const uploadBtn = document.getElementById('uploadAssinatura');
            const fileInput = document.getElementById('assinaturaFile');
            
            if (uploadBtn && fileInput) {
                uploadBtn.addEventListener('click', () => fileInput.click());
                
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            assinaturaDataURL = event.target.result;
                            updateAssinaturaPreview();
                            showNotification('Assinatura carregada com sucesso!', 'success');
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        }
        
        // Funções de desenho da assinatura
        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;
        }
        
        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(currentX, currentY);
            ctx.stroke();
            
            lastX = currentX;
            lastY = currentY;
        }
        
        function stopDrawing() {
            isDrawing = false;
        }
        
        function updateAssinaturaPreview() {
            const previewImg = document.getElementById('assinaturaPreview');
            const placeholder = document.getElementById('assinaturaPlaceholder');
            const semAssinatura = document.getElementById('semAssinatura');
            
            if (!previewImg || !semAssinatura) return;
            
            if (assinaturaDataURL) {
                previewImg.src = assinaturaDataURL;
                previewImg.classList.add('visible');
                semAssinatura.style.display = 'none';
                if (placeholder) placeholder.style.display = 'none';
            } else {
                previewImg.classList.remove('visible');
                semAssinatura.style.display = 'block';
                if (placeholder) placeholder.style.display = 'block';
            }
        }

        // Configurar formulário de termo de aquisição
        function setupTermoForm() {
            // Configurar sistema de assinatura
            setupAssinaturaSystem();
            
            // Configurar alternância para campos manuais
            const tipoSelect = document.getElementById('termo-tipo-equipamento');
            const tipoManualInput = document.getElementById('termo-tipo-manual');
            const departamentoSelect = document.getElementById('termo-departamento');
            const departamentoManualInput = document.getElementById('termo-departamento-manual');
            
            if (tipoSelect && tipoManualInput) {
                tipoSelect.addEventListener('change', function() {
                    tipoManualInput.style.display = this.value === 'outro' ? 'block' : 'none';
                    tipoManualInput.required = this.value === 'outro';
                });
            }
            
            if (departamentoSelect && departamentoManualInput) {
                departamentoSelect.addEventListener('change', function() {
                    departamentoManualInput.style.display = this.value === 'outro' ? 'block' : 'none';
                    departamentoManualInput.required = this.value === 'outro';
                });
            }
            
            // Configurar data atual
            const dataAquisicaoInput = document.getElementById('termo-data-aquisicao');
            if (dataAquisicaoInput) {
                dataAquisicaoInput.value = new Date().toISOString().split('T')[0];
            }
            
            // Configurar botão para visualizar termos salvos
            const visualizarTermosBtn = document.getElementById('visualizarTermosBtn');
            if (visualizarTermosBtn) {
                visualizarTermosBtn.addEventListener('click', function() {
                    if (!isLoggedIn) {
                        showNotification('Faça login para visualizar os termos!', 'danger');
                        return;
                    }
                    visualizarTermosSalvos();
                });
            }
            
            // Configurar limpar formulário
            const limparTermoBtn = document.getElementById('limpar-termo');
            if (limparTermoBtn) {
                limparTermoBtn.addEventListener('click', function() {
                    const termoForm = document.getElementById('termo-form');
                    if (termoForm) termoForm.reset();
                    if (dataAquisicaoInput) dataAquisicaoInput.value = new Date().toISOString().split('T')[0];
                    const termoPreview = document.getElementById('termo-preview');
                    if (termoPreview) termoPreview.style.display = 'none';
                    if (ctx) ctx.clearRect(0, 0, canvas.width, canvas.height);
                    assinaturaDataURL = null;
                    updateAssinaturaPreview();
                    if (tipoManualInput) tipoManualInput.style.display = 'none';
                    if (departamentoManualInput) departamentoManualInput.style.display = 'none';
                    termoAtual = null;
                });
            }
            
            // Configurar fechar preview
            const fecharPreviewBtn = document.getElementById('fechar-preview');
            if (fecharPreviewBtn) {
                fecharPreviewBtn.addEventListener('click', function() {
                    const termoPreview = document.getElementById('termo-preview');
                    if (termoPreview) termoPreview.style.display = 'none';
                });
            }
            
            // Configurar imprimir termo
            const imprimirTermoBtn = document.getElementById('imprimir-termo');
            if (imprimirTermoBtn) {
                imprimirTermoBtn.addEventListener('click', function() {
                    window.print();
                });
            }
            
            // Configurar salvar termo no site
            const salvarTermoSiteBtn = document.getElementById('salvar-termo-site');
            if (salvarTermoSiteBtn) {
                salvarTermoSiteBtn.addEventListener('click', function() {
                    salvarTermoNoSite();
                });
            }
            
            // Configurar envio do formulário
            const form = document.getElementById('termo-form');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    if (!isLoggedIn) {
                        showNotification('Faça login para gerar termos!', 'danger');
                        return;
                    }
                    
                    // Coletar dados do formulário
                    const tipoSelecionado = document.getElementById('termo-tipo-equipamento').value;
                    const tipo = tipoSelecionado === 'outro' ? 
                        document.getElementById('termo-tipo-manual').value : 
                        document.getElementById('termo-tipo-equipamento').value;
                    const marca = document.getElementById('termo-marca').value;
                    const modelo = document.getElementById('termo-modelo').value;
                    const serial = document.getElementById('termo-serial').value;
                    const patrimonio = document.getElementById('termo-patrimonio').value;
                    const fornecedor = document.getElementById('termo-fornecedor').value;
                    const notaFiscal = document.getElementById('termo-nota-fiscal').value;
                    const dataAquisicao = document.getElementById('termo-data-aquisicao').value;
                    const valor = parseFloat(document.getElementById('termo-valor').value) || 0;
                    const departamentoSelecionado = document.getElementById('termo-departamento').value;
                    const departamento = departamentoSelecionado === 'outro' ? 
                        document.getElementById('termo-departamento-manual').value : 
                        document.getElementById('termo-departamento').value;
                    const responsavel = document.getElementById('termo-responsavel').value;
                    const telefonePessoal = document.getElementById('termo-telefone-pessoal').value;
                    const email = document.getElementById('termo-email').value;
                    const cargo = document.getElementById('termo-cargo').value;
                    const observacoes = document.getElementById('termo-observacoes').value;
                    
                    // Validar campos obrigatórios
                    if (!tipo || !marca || !modelo || !patrimonio || !fornecedor || !notaFiscal || !dataAquisicao || !valor || !departamento || !responsavel || !telefonePessoal) {
                        showNotification('Preencha todos os campos obrigatórios!', 'danger');
                        return;
                    }
                    
                    // Validar assinatura
                    if (!assinaturaDataURL) {
                        showNotification('Por favor, adicione uma assinatura digitalizada!', 'warning');
                        return;
                    }
                    
                    // Criar objeto termoAtual
                    termoAtual = {
                        id: Date.now(), // ID único baseado no timestamp
                        numeroTermo: gerarNumeroTermo(),
                        tipo: tipoSelecionado === 'outro' ? tipo : formatText(tipo),
                        marca: marca,
                        modelo: modelo,
                        serial: serial || 'Não informado',
                        patrimonio: patrimonio,
                        fornecedor: fornecedor,
                        notaFiscal: notaFiscal,
                        dataAquisicao: dataAquisicao,
                        valor: valor,
                        departamento: departamentoSelecionado === 'outro' ? departamento : formatText(departamento),
                        responsavel: responsavel,
                        telefonePessoal: telefonePessoal,
                        email: email || 'Não informado',
                        cargo: cargo || 'Não informado',
                        observacoes: observacoes || 'Nenhuma observação adicional.',
                        assinatura: assinaturaDataURL,
                        dataCriacao: new Date().toISOString().split('T')[0]
                    };
                    
                    // Atualizar preview
                    const agora = new Date();
                    document.getElementById('preview-data').textContent = agora.toLocaleDateString('pt-BR');
                    document.getElementById('preview-numero-termo').textContent = termoAtual.numeroTermo;
                    document.getElementById('preview-responsavel').textContent = responsavel;
                    document.getElementById('preview-cargo').textContent = cargo || 'Não informado';
                    document.getElementById('preview-departamento').textContent = departamentoSelecionado === 'outro' ? 
                        departamento : 
                        formatText(departamento);
                    document.getElementById('preview-tipo').textContent = tipoSelecionado === 'outro' ? tipo : formatText(tipo);
                    document.getElementById('preview-marca-modelo').textContent = `${marca} ${modelo}`;
                    document.getElementById('preview-serial').textContent = serial || 'Não informado';
                    document.getElementById('preview-patrimonio').textContent = patrimonio;
                    document.getElementById('preview-fornecedor').textContent = fornecedor;
                    document.getElementById('preview-nota-fiscal').textContent = notaFiscal;
                    document.getElementById('preview-data-aquisicao').textContent = new Date(dataAquisicao).toLocaleDateString('pt-BR');
                    document.getElementById('preview-valor').textContent = formatCurrency(valor);
                    document.getElementById('preview-telefone').textContent = telefonePessoal;
                    document.getElementById('preview-email').textContent = email || 'Não informado';
                    document.getElementById('preview-observacoes').textContent = observacoes || 'Nenhuma observação adicional.';
                    document.getElementById('preview-data-hoje').textContent = agora.toLocaleDateString('pt-BR');
                    document.getElementById('preview-nome-assinatura').textContent = responsavel;
                    document.getElementById('preview-telefone-assinatura').textContent = telefonePessoal;
                    
                    // Atualizar assinatura no preview
                    const assinaturaPreviewImg = document.getElementById('assinaturaResponsavelImg');
                    const assinaturaPlaceholder = document.getElementById('assinaturaPlaceholder');
                    if (assinaturaDataURL) {
                        assinaturaPreviewImg.src = assinaturaDataURL;
                        assinaturaPreviewImg.style.display = 'block';
                        if (assinaturaPlaceholder) assinaturaPlaceholder.style.display = 'none';
                    }
                    
                    // Mostrar preview
                    document.getElementById('termo-preview').style.display = 'block';
                    
                    // Rolar até o preview
                    document.getElementById('termo-preview').scrollIntoView({ behavior: 'smooth' });
                    
                    showNotification('Termo gerado com sucesso! Agora você pode salvá-lo no site.', 'success');
                });
            }
        }
        
        // Função para gerar número único para termo
        function gerarNumeroTermo() {
            const ultimoNumero = dadosSistema.termosAquisicao.length > 0 ? 
                Math.max(...dadosSistema.termosAquisicao.map(t => t.numeroTermo || 0)) : 0;
            return (ultimoNumero + 1).toString().padStart(3, '0');
        }
        
        // Função para salvar termo no site
        function salvarTermoNoSite() {
            if (!termoAtual) {
                showNotification('Nenhum termo para salvar!', 'danger');
                return;
            }
            
            // Verificar se já existe termo com mesmo patrimônio
            const termoExistente = dadosSistema.termosAquisicao.find(t => t.patrimonio === termoAtual.patrimonio);
            
            if (termoExistente) {
                if (!confirm(`Já existe um termo com o patrimônio ${termoAtual.patrimonio}. Deseja substituí-lo?`)) {
                    return;
                }
                // Remover termo existente
                const index = dadosSistema.termosAquisicao.findIndex(t => t.patrimonio === termoAtual.patrimonio);
                dadosSistema.termosAquisicao.splice(index, 1);
            }
            
            // Adicionar termo à lista (no início para ser mais recente primeiro)
            dadosSistema.termosAquisicao.unshift(termoAtual);
            
            // Salvar no localStorage
            sincronizarDados();
            
            // Atualizar contador
            atualizarContadorTermos();
            
            // Mostrar mensagem de sucesso
            showNotification(`Termo ${termoAtual.numeroTermo} salvo com sucesso!`, 'success');
            
            // Limpar formulário
            const termoForm = document.getElementById('termo-form');
            if (termoForm) termoForm.reset();
            const dataAquisicaoInput = document.getElementById('termo-data-aquisicao');
            if (dataAquisicaoInput) dataAquisicaoInput.value = new Date().toISOString().split('T')[0];
            const termoPreview = document.getElementById('termo-preview');
            if (termoPreview) termoPreview.style.display = 'none';
            if (ctx) ctx.clearRect(0, 0, canvas.width, canvas.height);
            assinaturaDataURL = null;
            updateAssinaturaPreview();
            const tipoManualInput = document.getElementById('termo-tipo-manual');
            if (tipoManualInput) tipoManualInput.style.display = 'none';
            const departamentoManualInput = document.getElementById('termo-departamento-manual');
            if (departamentoManualInput) departamentoManualInput.style.display = 'none';
            termoAtual = null;
        }
        
        // Função para visualizar termos salvos
        function visualizarTermosSalvos() {
            const modal = document.getElementById('termosModal');
            const tableBody = document.getElementById('termos-table-body');
            
            if (!modal || !tableBody) return;
            
            // Limpar tabela
            tableBody.innerHTML = '';
            
            // Ordenar termos por data (mais recente primeiro)
            const termosOrdenados = [...dadosSistema.termosAquisicao].sort((a, b) => {
                return new Date(b.dataCriacao) - new Date(a.dataCriacao);
            });
            
            if (termosOrdenados.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 30px; color: var(--gray);">
                            <i class="fas fa-file-alt" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            Nenhum termo salvo ainda.
                        </td>
                    </tr>
                `;
            } else {
                termosOrdenados.forEach(termo => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${new Date(termo.dataCriacao).toLocaleDateString('pt-BR')}</td>
                        <td><strong>${termo.patrimonio}</strong></td>
                        <td>${termo.tipo} - ${termo.marca}</td>
                        <td>${termo.responsavel}</td>
                        <td>${termo.departamento}</td>
                        <td>
                            <button class="btn-small btn-primary" onclick="visualizarTermoDetalhes(${termo.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-small btn-secondary" onclick="imprimirTermoSalvo(${termo.id})">
                                <i class="fas fa-print"></i>
                            </button>
                            <button class="btn-small btn-danger" onclick="excluirTermo(${termo.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
            
            // Atualizar contador
            atualizarContadorTermos();
            
            // Mostrar modal
            modal.classList.add('active');
            
            // Fechar modal quando clicar no botão de fechar
            const closeTermosModal = modal.querySelector('.close-termos-modal');
            const fecharTermosBtn = document.getElementById('fecharTermosBtn');
            
            const fecharModal = function() {
                modal.classList.remove('active');
            };
            
            if (closeTermosModal) {
                closeTermosModal.onclick = fecharModal;
            }
            
            if (fecharTermosBtn) {
                fecharTermosBtn.onclick = fecharModal;
            }
            
            // Fechar modal quando clicar fora
            modal.onclick = function(e) {
                if (e.target === modal) {
                    fecharModal();
                }
            };
            
            // Novo termo
            const novoTermoBtn = document.getElementById('novoTermoBtn');
            if (novoTermoBtn) {
                novoTermoBtn.onclick = function() {
                    fecharModal();
                    // Navegar para o formulário de termo
                    const termoLink = document.querySelector('[data-section="termo-aquisicao"]');
                    if (termoLink) termoLink.click();
                };
            }
        }
        
        // Função para visualizar detalhes de um termo
        function visualizarTermoDetalhes(termoId) {
            const termo = dadosSistema.termosAquisicao.find(t => t.id === termoId);
            if (!termo) {
                showNotification('Termo não encontrado!', 'danger');
                return;
            }
            
            // Criar modal de detalhes
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 2001;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: var(--radius); padding: 40px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto; box-shadow: var(--shadow-lg);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                        <h3><i class="fas fa-file-contract"></i> Detalhes do Termo ${termo.numeroTermo}</h3>
                        <button class="close-detalhes-modal" style="background: none; border: none; font-size: 1.8rem; color: var(--gray); cursor: pointer;">&times;</button>
                    </div>
                    
                    <div class="termo-preview" style="margin-top: 0; border: none; box-shadow: none; padding: 0;">
                        <div class="termo-header">
                            <h2>TERMO DE AQUISIÇÃO E RECEBIMENTO</h2>
                            <h3>PREFEITURA MUNICIPAL DE CAMPO DO MEIO - MG</h3>
                            <p>Secretaria Municipal de Educação</p>
                            <div style="margin-top: 15px; font-size: 0.9rem; color: var(--gray);">
                                <i class="fas fa-calendar-alt"></i> Data: ${new Date(termo.dataCriacao).toLocaleDateString('pt-BR')}
                                <span style="margin-left: 20px;"><i class="fas fa-hashtag"></i> Nº: ${termo.numeroTermo}</span>
                            </div>
                        </div>
                        
                        <div style="margin: 30px 0;">
                            <p>Eu, <strong>${termo.responsavel}</strong>, no cargo de <strong>${termo.cargo}</strong>, responsável pelo departamento de <strong>${termo.departamento}</strong>, declaro ter recebido o seguinte equipamento de informática, adquirido pela Prefeitura Municipal de Campo do Meio:</p>
                            
                            <table class="termo-table">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Descrição</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Tipo</strong></td>
                                        <td>${termo.tipo}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Marca/Modelo</strong></td>
                                        <td>${termo.marca} ${termo.modelo}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Nº de Série</strong></td>
                                        <td>${termo.serial}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Nº do Patrimônio</strong></td>
                                        <td>${termo.patrimonio}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Fornecedor</strong></td>
                                        <td>${termo.fornecedor}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Nota Fiscal</strong></td>
                                        <td>${termo.notaFiscal}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Data de Aquisição</strong></td>
                                        <td>${new Date(termo.dataAquisicao).toLocaleDateString('pt-BR')}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Valor</strong></td>
                                        <td>${formatCurrency(termo.valor)}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Telefone Pessoal</strong></td>
                                        <td>${termo.telefonePessoal}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Email</strong></td>
                                        <td>${termo.email}</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <div style="margin: 30px 0;">
                                <h4>OBSERVAÇÕES / ESPECIFICAÇÕES TÉCNICAS</h4>
                                <p style="white-space: pre-line; background: var(--light-gray); padding: 15px; border-radius: 8px;">${termo.observacoes}</p>
                            </div>
                            
                            <p>Declaro que o equipamento acima descrito foi recebido em perfeitas condições de funcionamento e assumo a responsabilidade pela sua guarda, conservação e uso adequado, comprometendo-me a comunicar imediatamente qualquer avaria ou problema técnico.</p>
                            
                            <p style="margin-top: 30px;">Campo do Meio, ${new Date(termo.dataCriacao).toLocaleDateString('pt-BR')}.</p>
                        </div>
                        
                        <div class="termo-assinaturas" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px;">
                            <div class="assinatura-box">
                                <p><strong>ASSINATURA DO RESPONSÁVEL</strong></p>
                                <div style="height: 150px; display: flex; align-items: center; justify-content: center; border: 2px solid var(--border); border-radius: 10px; margin: 15px auto; background: white; position: relative;">
                                    <img src="${termo.assinatura}" style="max-width: 90%; max-height: 90%;" alt="Assinatura do responsável">
                                </div>
                                <div style="border-top: 1px solid var(--dark); margin: 20px auto; width: 200px;"></div>
                                <p style="font-weight: bold;">${termo.responsavel}</p>
                                <p>Responsável pelo Departamento</p>
                                <p>${termo.telefonePessoal}</p>
                            </div>
                            
                            <div class="assinatura-box">
                                <p><strong>ASSINATURA DO TÉCNICO</strong></p>
                                <div style="height: 150px; display: flex; align-items: center; justify-content: center; color: var(--gray); border: 2px solid var(--border); border-radius: 10px; margin: 15px auto; background: white;">
                                    <p>Assinatura do Técnico de Informática</p>
                                </div>
                                <div style="border-top: 1px solid var(--dark); margin: 20px auto; width: 200px;"></div>
                                <p style="font-weight: bold;">________________________________</p>
                                <p>Técnico de Informática</p>
                                <p>Secretaria de Educação</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-buttons" style="margin-top: 40px;">
                        <button onclick="imprimirTermoSalvo(${termo.id})" class="btn btn-primary">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                        <button class="btn btn-secondary close-detalhes-modal2">
                            <i class="fas fa-times"></i> Fechar
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Configurar eventos de fechar
            const closeBtns = modal.querySelectorAll('.close-detalhes-modal, .close-detalhes-modal2');
            closeBtns.forEach(btn => {
                btn.onclick = function() {
                    modal.remove();
                };
            });
            
            // Fechar quando clicar fora
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
        }
        
        // Função para imprimir termo salvo
        function imprimirTermoSalvo(termoId) {
            const termo = dadosSistema.termosAquisicao.find(t => t.id === termoId);
            if (!termo) {
                showNotification('Termo não encontrado!', 'danger');
                return;
            }
            
            // Criar uma nova janela para impressão
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="pt-br">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Termo de Aquisição ${termo.numeroTermo}</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            line-height: 1.6;
                            color: #333;
                            padding: 20px;
                            max-width: 800px;
                            margin: 0 auto;
                        }
                        .termo-header {
                            text-align: center;
                            margin-bottom: 40px;
                            border-bottom: 3px solid #2563eb;
                            padding-bottom: 20px;
                        }
                        .termo-header h2 {
                            color: #2563eb;
                            font-size: 24px;
                            margin-bottom: 10px;
                        }
                        .termo-header h3 {
                            color: #333;
                            font-size: 18px;
                            margin-bottom: 5px;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 20px 0;
                        }
                        th {
                            background: #2563eb;
                            color: white;
                            padding: 12px;
                            text-align: left;
                        }
                        td {
                            padding: 12px;
                            border-bottom: 1px solid #ddd;
                        }
                        .assinaturas {
                            display: flex;
                            justify-content: space-between;
                            margin-top: 60px;
                            page-break-inside: avoid;
                        }
                        .assinatura-box {
                            width: 48%;
                            text-align: center;
                        }
                        .assinatura-linha {
                            border-top: 1px solid #333;
                            margin: 20px auto;
                            width: 200px;
                        }
                        @media print {
                            body {
                                padding: 0;
                            }
                            .no-print {
                                display: none;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="termo-header">
                        <h2>TERMO DE AQUISIÇÃO E RECEBIMENTO</h2>
                        <h3>PREFEITURA MUNICIPAL DE CAMPO DO MEIO - MG</h3>
                        <p>Secretaria Municipal de Educação</p>
                        <div style="margin-top: 15px; font-size: 14px; color: #666;">
                            <strong>Data:</strong> ${new Date(termo.dataCriacao).toLocaleDateString('pt-BR')}
                            <span style="margin-left: 20px;"><strong>Nº:</strong> ${termo.numeroTermo}</span>
                        </div>
                    </div>
                    
                    <div style="margin: 30px 0;">
                        <p>Eu, <strong>${termo.responsavel}</strong>, no cargo de <strong>${termo.cargo}</strong>, responsável pelo departamento de <strong>${termo.departamento}</strong>, declaro ter recebido o seguinte equipamento de informática, adquirido pela Prefeitura Municipal de Campo do Meio:</p>
                        
                        <table>
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Descrição</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Tipo</strong></td>
                                    <td>${termo.tipo}</td>
                                </tr>
                                <tr>
                                    <td><strong>Marca/Modelo</strong></td>
                                    <td>${termo.marca} ${termo.modelo}</td>
                                </tr>
                                <tr>
                                    <td><strong>Nº de Série</strong></td>
                                    <td>${termo.serial}</td>
                                </tr>
                                <tr>
                                    <td><strong>Nº do Patrimônio</strong></td>
                                    <td>${termo.patrimonio}</td>
                                </tr>
                                <tr>
                                    <td><strong>Fornecedor</strong></td>
                                    <td>${termo.fornecedor}</td>
                                </tr>
                                <tr>
                                    <td><strong>Nota Fiscal</strong></td>
                                    <td>${termo.notaFiscal}</td>
                                </tr>
                                <tr>
                                    <td><strong>Data de Aquisição</strong></td>
                                    <td>${new Date(termo.dataAquisicao).toLocaleDateString('pt-BR')}</td>
                                </tr>
                                <tr>
                                    <td><strong>Valor</strong></td>
                                    <td>${formatCurrency(termo.valor)}</td>
                                </tr>
                                <tr>
                                    <td><strong>Telefone Pessoal</strong></td>
                                    <td>${termo.telefonePessoal}</td>
                                </tr>
                                <tr>
                                    <td><strong>Email</strong></td>
                                    <td>${termo.email}</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div style="margin: 30px 0;">
                            <h4>OBSERVAÇÕES / ESPECIFICAÇÕES TÉCNICAS</h4>
                            <p style="white-space: pre-line; background: #f5f5f5; padding: 15px; border-radius: 8px;">${termo.observacoes}</p>
                        </div>
                        
                        <p>Declaro que o equipamento acima descrito foi recebido em perfeitas condições de funcionamento e assumo a responsabilidade pela sua guarda, conservação e uso adequado, comprometendo-me a comunicar imediatamente qualquer avaria ou problema técnico.</p>
                        
                        <p style="margin-top: 30px;">Campo do Meio, ${new Date(termo.dataCriacao).toLocaleDateString('pt-BR')}.</p>
                    </div>
                    
                    <div class="assinaturas">
                        <div class="assinatura-box">
                            <p><strong>ASSINATURA DO RESPONSÁVEL</strong></p>
                            <img src="${termo.assinatura}" style="max-width: 200px; max-height: 80px; margin: 10px 0;" alt="Assinatura">
                            <div class="assinatura-linha"></div>
                            <p style="font-weight: bold;">${termo.responsavel}</p>
                            <p>Responsável pelo Departamento</p>
                            <p>${termo.telefonePessoal}</p>
                        </div>
                        
                        <div class="assinatura-box">
                            <p><strong>ASSINATURA DO TÉCNICO</strong></p>
                            <div style="height: 80px; display: flex; align-items: center; justify-content: center; color: #666; margin: 10px 0;">
                                <p>Assinatura do Técnico de Informática</p>
                            </div>
                            <div class="assinatura-linha"></div>
                            <p style="font-weight: bold;">________________________________</p>
                            <p>Técnico de Informática</p>
                            <p>Secretaria de Educação</p>
                        </div>
                    </div>
                    
                    <div class="no-print" style="margin-top: 40px; text-align: center;">
                        <button onclick="window.print()" style="padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Imprimir Termo
                        </button>
                        <button onclick="window.close()" style="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                            Fechar
                        </button>
                    </div>
                    
                    <script>
                        // Auto-print
                        window.onload = function() {
                            window.print();
                        };
                    <\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }
        
        // Função para excluir termo
        function excluirTermo(termoId) {
            if (!isLoggedIn) {
                showNotification('Faça login para excluir termos!', 'danger');
                return;
            }
            
            const termo = dadosSistema.termosAquisicao.find(t => t.id === termoId);
            if (!termo) {
                showNotification('Termo não encontrado!', 'danger');
                return;
            }
            
            if (!confirm(`Tem certeza que deseja excluir o termo ${termo.numeroTermo} - ${termo.patrimonio}?`)) {
                return;
            }
            
            // Remover termo
            const index = dadosSistema.termosAquisicao.findIndex(t => t.id === termoId);
            dadosSistema.termosAquisicao.splice(index, 1);
            
            // Salvar no localStorage
            sincronizarDados();
            
            // Atualizar contador
            atualizarContadorTermos();
            
            // Recarregar lista
            visualizarTermosSalvos();
            
            showNotification('Termo excluído com sucesso!', 'success');
        }

        // Atualizar contador de termos
        function atualizarContadorTermos() {
            const total = dadosSistema.termosAquisicao.length;
            document.getElementById('total-termos').textContent = total;
            document.getElementById('total-termos-section').textContent = total;
            document.getElementById('config-termos-count').textContent = total;
            
            if (total > 0) {
                const ultimoTermo = dadosSistema.termosAquisicao[dadosSistema.termosAquisicao.length - 1];
                document.getElementById('ultimo-termo').textContent = 
                    `${ultimoTermo.patrimonio} - ${ultimoTermo.dataCriacao}`;
            }
        }

        // Carregar tabela de estoque
        function loadEstoqueTable() {
            const tableBody = document.getElementById('estoque-table-body');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            Object.keys(dadosSistema.estoque).forEach(key => {
                const item = dadosSistema.estoque[key];
                const quantidade = item.quantidade || 0;
                const minimo = item.minimo || 5;
                
                let statusText = 'Disponível';
                let statusClass = 'badge-disponivel';
                
                if (quantidade === 0) {
                    statusText = 'Sem Estoque';
                    statusClass = 'badge-sem';
                } else if (quantidade <= 2) {
                    statusText = 'Crítico';
                    statusClass = 'badge-critico';
                } else if (quantidade <= minimo) {
                    statusText = 'Baixo';
                    statusClass = 'badge-baixo';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="estoque-icon" style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: white;">
                                <i class="fas ${item.icone || 'fa-box'}"></i>
                            </div>
                            <strong>${item.nome}</strong>
                        </div>
                    </td>
                    <td>${formatText(item.categoria || 'outros')}</td>
                    <td class="quantidade-cell">${quantidade}</td>
                    <td>${minimo}</td>
                    <td class="status-cell">
                        <span class="estoque-badge ${statusClass}" style="position: static; display: inline-block;">
                            ${statusText}
                        </span>
                    </td>
                    <td class="acoes-cell">
                        <button class="btn btn-primary btn-small" onclick="editarProduto('${key}')" ${!isLoggedIn ? 'disabled' : ''}>
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-danger btn-small" onclick="excluirProduto('${key}')" ${!isLoggedIn ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Configurar modal de produto
        function setupProductModal() {
            const addBtn = document.getElementById('addProductBtn');
            const adicionarProdutoBtn = document.getElementById('adicionarProdutoBtn');
            const modal = document.getElementById('productModal');
            const closeBtn = modal?.querySelector('.close-modal');
            const cancelBtn = document.getElementById('cancelProductBtn');
            const deleteBtn = document.getElementById('deleteProductBtn');
            const form = document.getElementById('productForm');
            const modalTitle = document.getElementById('modalTitle');
            
            if (!modal || !form) return;
            
            const openModal = (mode = 'add', productKey = null) => {
                if (mode === 'add') {
                    modalTitle.textContent = 'Adicionar Novo Produto';
                    form.reset();
                    document.getElementById('productIcon').value = 'fa-box';
                    document.getElementById('productKey').value = '';
                    if (deleteBtn) deleteBtn.style.display = 'none';
                } else if (mode === 'edit' && productKey && dadosSistema.estoque[productKey]) {
                    modalTitle.textContent = 'Editar Produto';
                    const produto = dadosSistema.estoque[productKey];
                    document.getElementById('productName').value = produto.nome;
                    document.getElementById('productCategory').value = produto.categoria || 'outros';
                    document.getElementById('productQuantity').value = produto.quantidade || 0;
                    document.getElementById('productMin').value = produto.minimo || 5;
                    document.getElementById('productIcon').value = produto.icone || 'fa-box';
                    document.getElementById('productKey').value = productKey;
                    if (deleteBtn) deleteBtn.style.display = 'inline-flex';
                }
                modal.classList.add('active');
            };
            
            const closeModal = () => {
                modal.classList.remove('active');
                form.reset();
            };
            
            // Abrir modal para adicionar
            if (addBtn) {
                addBtn.addEventListener('click', () => openModal('add'));
            }
            if (adicionarProdutoBtn) {
                adicionarProdutoBtn.addEventListener('click', () => openModal('add'));
            }
            
            // Fechar modal
            if (closeBtn) {
                closeBtn.addEventListener('click', closeModal);
            }
            if (cancelBtn) {
                cancelBtn.addEventListener('click', closeModal);
            }
            
            // Excluir produto
            if (deleteBtn) {
                deleteBtn.addEventListener('click', function() {
                    const productKey = document.getElementById('productKey').value;
                    if (productKey && confirm(`Tem certeza que deseja excluir ${dadosSistema.estoque[productKey]?.nome}?`)) {
                        delete dadosSistema.estoque[productKey];
                        sincronizarDados();
                        loadEstoqueTable();
                        loadDashboard();
                        loadEstatisticas();
                        showNotification('Produto excluído com sucesso!', 'success');
                        closeModal();
                    }
                });
            }
            
            // Salvar produto
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const nome = document.getElementById('productName').value.trim();
                const categoria = document.getElementById('productCategory').value;
                const quantidade = parseInt(document.getElementById('productQuantity').value) || 0;
                const minimo = parseInt(document.getElementById('productMin').value) || 5;
                const icone = document.getElementById('productIcon').value.trim() || 'fa-box';
                const productKey = document.getElementById('productKey').value;
                
                if (!nome || !categoria) {
                    showNotification('Preencha todos os campos obrigatórios!', 'danger');
                    return;
                }
                
                // Criar ou atualizar produto
                const key = productKey || nome.toLowerCase().replace(/\s+/g, '_').replace(/[^\w_]/g, '');
                
                if (!productKey && dadosSistema.estoque[key]) {
                    showNotification('Já existe um produto com esse nome!', 'danger');
                    return;
                }
                
                dadosSistema.estoque[key] = {
                    nome: nome,
                    quantidade: quantidade,
                    minimo: minimo,
                    categoria: categoria,
                    icone: icone
                };
                
                // Se estiver editando e mudou a chave, remover a antiga
                if (productKey && productKey !== key) {
                    delete dadosSistema.estoque[productKey];
                }
                
                sincronizarDados();
                loadEstoqueTable();
                loadConfiguracoes();
                loadEstatisticas();
                
                showNotification(`Produto ${productKey ? 'editado' : 'adicionado'} com sucesso!`, 'success');
                closeModal();
            });
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
        }

        // Configurar sistema de backup
        function setupBackupSystem() {
            const exportarBackupBtn = document.getElementById('exportarBackupBtn');
            const importarBackupBtn = document.getElementById('importarBackupBtn');
            const forcarSincronizacaoBtn = document.getElementById('forcarSincronizacaoBtn');
            const limparDadosLocalBtn = document.getElementById('limparDadosLocalBtn');
            const recarregarDadosBtn = document.getElementById('recarregarDadosBtn');
            const resetarDispositivoBtn = document.getElementById('resetarDispositivoBtn');
            
            // Exportar backup
            if (exportarBackupBtn) {
                exportarBackupBtn.addEventListener('click', function() {
                    if (!isLoggedIn) {
                        showNotification('Faça login para exportar backup!', 'danger');
                        return;
                    }
                    
                    const backup = {
                        registros: dadosSistema.registros,
                        estoque: dadosSistema.estoque,
                        tiposLocais: dadosSistema.tiposLocais,
                        termosAquisicao: dadosSistema.termosAquisicao,
                        dataBackup: new Date().toISOString(),
                        versao: '2.0'
                    };
                    
                    const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `backup_equipamentos_${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showNotification('Backup exportado com sucesso!', 'success');
                });
            }
            
            // Importar backup
            if (importarBackupBtn) {
                importarBackupBtn.addEventListener('click', function() {
                    if (!isLoggedIn) {
                        showNotification('Faça login para importar backup!', 'danger');
                        return;
                    }
                    
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json';
                    
                    input.addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            try {
                                const backup = JSON.parse(event.target.result);
                                
                                if (!confirm(`Deseja importar backup de ${backup.dataBackup}? Esta ação substituirá os dados atuais.`)) {
                                    return;
                                }
                                
                                // Validar estrutura do backup
                                if (!backup.registros || !backup.estoque || !backup.tiposLocais) {
                                    showNotification('Arquivo de backup inválido!', 'danger');
                                    return;
                                }
                                
                                // Importar dados
                                dadosSistema.registros = backup.registros;
                                dadosSistema.estoque = backup.estoque;
                                dadosSistema.tiposLocais = backup.tiposLocais;
                                dadosSistema.termosAquisicao = backup.termosAquisicao || [];
                                
                                // Salvar dados
                                sincronizarDados();
                                
                                // Atualizar interface
                                atualizarTodasTelas();
                                
                                showNotification('Backup importado com sucesso!', 'success');
                            } catch (error) {
                                console.error('Erro ao importar backup:', error);
                                showNotification('Erro ao importar backup. Arquivo inválido!', 'danger');
                            }
                        };
                        reader.readAsText(file);
                    });
                    
                    input.click();
                });
            }
            
            // Forçar sincronização
            if (forcarSincronizacaoBtn) {
                forcarSincronizacaoBtn.addEventListener('click', function() {
                    if (!isLoggedIn) {
                        showNotification('Faça login para sincronizar!', 'danger');
                        return;
                    }
                    
                    if (sincronizarDados()) {
                        showNotification('Sincronização forçada realizada com sucesso!', 'success');
                    }
                });
            }
            
            // Limpar dados local
            if (limparDadosLocalBtn) {
                limparDadosLocalBtn.addEventListener('click', function() {
                    if (!isLoggedIn) {
                        showNotification('Faça login para executar esta ação!', 'danger');
                        return;
                    }
                    
                    if (!confirm('Tem certeza que deseja limpar os dados locais? Os dados do servidor serão mantidos.')) {
                        return;
                    }
                    
                    localStorage.removeItem(CONFIG.APP_NAME + '_dados');
                    carregarDadosSincronizados();
                    atualizarTodasTelas();
                    
                    showNotification('Dados locais limpos com sucesso!', 'success');
                });
            }
            
            // Recarregar dados do servidor
            if (recarregarDadosBtn) {
                recarregarDadosBtn.addEventListener('click', function() {
                    if (!isLoggedIn) {
                        showNotification('Faça login para executar esta ação!', 'danger');
                        return;
                    }
                    
                    if (!confirm('Tem certeza que deseja recarregar os dados do servidor? Os dados locais serão substituídos.')) {
                        return;
                    }
                    
                    carregarDadosSincronizados();
                    atualizarTodasTelas();
                    
                    showNotification('Dados recarregados do servidor!', 'success');
                });
            }
            
            // Resetar dispositivo
            if (resetarDispositivoBtn) {
                resetarDispositivoBtn.addEventListener('click', function() {
                    if (!isLoggedIn) {
                        showNotification('Faça login para executar esta ação!', 'danger');
                        return;
                    }
                    
                    if (!confirm('Tem certeza que deseja resetar este dispositivo? O ID do dispositivo será alterado.')) {
                        return;
                    }
                    
                    localStorage.removeItem('dispositivo_id');
                    localStorage.removeItem('dispositivo_nome');
                    identificarDispositivo();
                    
                    showNotification('Dispositivo resetado com sucesso!', 'success');
                });
            }
        }

        // Carregar configurações
        function loadConfiguracoes() {
            const equipamentosList = document.getElementById('equipamentos-list');
            if (equipamentosList) {
                equipamentosList.innerHTML = '';
                
                Object.keys(dadosSistema.estoque).forEach(key => {
                    const li = document.createElement('li');
                    li.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--border);';
                    li.innerHTML = `
                        <span>${dadosSistema.estoque[key].nome} <small style="color: var(--gray);">(${formatText(dadosSistema.estoque[key].categoria)})</small></span>
                        <div>
                            <button class="btn-small btn-primary" onclick="editarProduto('${key}')" ${!isLoggedIn ? 'disabled' : ''}>
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-small btn-danger" onclick="excluirProduto('${key}')" ${!isLoggedIn ? 'disabled' : ''}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    equipamentosList.appendChild(li);
                });
            }
            
            const locaisList = document.getElementById('locais-list');
            if (locaisList) {
                locaisList.innerHTML = '';
                
                dadosSistema.tiposLocais.forEach(local => {
                    const li = document.createElement('li');
                    li.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--border);';
                    li.innerHTML = `
                        <span>${local}</span>
                        <button class="btn-small btn-danger" onclick="removerLocal('${local}')" ${!isLoggedIn ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    locaisList.appendChild(li);
                });
            }
            
            // Configurar botões da aba de termos
            const verTermosConfigBtn = document.getElementById('verTermosConfigBtn');
            if (verTermosConfigBtn) {
                verTermosConfigBtn.addEventListener('click', function() {
                    visualizarTermosSalvos();
                });
            }
            
            const limparTermosBtn = document.getElementById('limparTermosBtn');
            if (limparTermosBtn) {
                limparTermosBtn.addEventListener('click', function() {
                    if (!isLoggedIn) {
                        showNotification('Faça login para limpar os termos!', 'danger');
                        return;
                    }
                    
                    if (dadosSistema.termosAquisicao.length === 0) {
                        showNotification('Não há termos para limpar!', 'info');
                        return;
                    }
                    
                    if (!confirm(`Tem certeza que deseja excluir TODOS os ${dadosSistema.termosAquisicao.length} termos salvos? Esta ação não pode ser desfeita.`)) {
                        return;
                    }
                    
                    dadosSistema.termosAquisicao = [];
                    sincronizarDados();
                    atualizarContadorTermos();
                    showNotification('Todos os termos foram excluídos!', 'success');
                    loadConfiguracoes();
                });
            }
            
            // Configurar sistema de backup
            setupBackupSystem();
            
            // Atualizar informações de sincronização
            atualizarInfoSincronizacao();
        }

        // Configurar tabs de configurações
        function setupConfigTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabPanes = document.querySelectorAll('.tab-pane');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabPanes.forEach(p => p.classList.remove('active'));
                    
                    this.classList.add('active');
                    const tabPane = document.getElementById(tabId);
                    if (tabPane) tabPane.classList.add('active');
                    
                    // Se for a aba de termos, atualizar contador
                    if (tabId === 'termos') {
                        atualizarContadorTermos();
                    }
                    
                    // Se for a aba de sincronização, atualizar informações
                    if (tabId === 'sincronizacao') {
                        atualizarInfoSincronizacao();
                    }
                });
            });
        }

        // Funções auxiliares
        function editarProduto(key) {
            setupProductModal();
            const event = new Event('click');
            const addProductBtn = document.getElementById('addProductBtn');
            if (addProductBtn) addProductBtn.dispatchEvent(event);
            
            setTimeout(() => {
                const modalTitle = document.getElementById('modalTitle');
                const form = document.getElementById('productForm');
                const produto = dadosSistema.estoque[key];
                
                if (produto && modalTitle && form) {
                    modalTitle.textContent = 'Editar Produto';
                    document.getElementById('productName').value = produto.nome;
                    document.getElementById('productCategory').value = produto.categoria || 'outros';
                    document.getElementById('productQuantity').value = produto.quantidade || 0;
                    document.getElementById('productMin').value = produto.minimo || 5;
                    document.getElementById('productIcon').value = produto.icone || 'fa-box';
                    document.getElementById('productKey').value = key;
                    const deleteBtn = document.getElementById('deleteProductBtn');
                    if (deleteBtn) deleteBtn.style.display = 'inline-flex';
                }
            }, 100);
        }

        function excluirProduto(key) {
            if (confirm(`Tem certeza que deseja excluir ${dadosSistema.estoque[key]?.nome}?`)) {
                delete dadosSistema.estoque[key];
                sincronizarDados();
                loadEstoqueTable();
                loadConfiguracoes();
                loadDashboard();
                loadEstatisticas();
                showNotification('Produto excluído com sucesso!', 'success');
            }
        }

        function removerLocal(local) {
            if (confirm(`Remover ${local}?`)) {
                dadosSistema.tiposLocais = dadosSistema.tiposLocais.filter(l => l !== local);
                sincronizarDados();
                loadConfiguracoes();
                showNotification('Local removido!', 'success');
            }
        }

        // ==============================================
        // INICIALIZAÇÃO
        // ==============================================

        document.addEventListener('DOMContentLoaded', function() {
            // Identificar dispositivo
            identificarDispositivo();
            
            // Carregar dados sincronizados
            carregarDadosSincronizados();
            
            // Atualizar data/hora
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // Configurar sistemas
            setupLoginSystem();
            setupNavigation();
            setupConfigTabs();
            setupProductModal();
            configurarOuvinteSincronizacao();
            
            // Configurar sincronização automática
            setInterval(sincronizarDados, CONFIG.SYNC_INTERVAL);
            
            // Carregar dashboard inicial
            loadDashboard();
            loadEstatisticas();
            loadConsultar();
            loadEstoqueTable();
            atualizarContadorTermos();
            
            console.log('Sistema sincronizado inicializado com sucesso!');
            console.log(`Registros carregados: ${dadosSistema.registros.length}`);
            console.log(`Termos salvos: ${dadosSistema.termosAquisicao.length}`);
            console.log(`Dispositivo atual: ${dadosSistema.dispositivoAtual?.id}`);
        });
    </script>
</body>
</html>